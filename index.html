<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="好记性不如烂笔头,更何况记性还不好">
<meta property="og:type" content="website">
<meta property="og:title" content="Fujia's Blog">
<meta property="og:url" content="https://fujiador.github.io/index.html">
<meta property="og:site_name" content="Fujia's Blog">
<meta property="og:description" content="好记性不如烂笔头,更何况记性还不好">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fujia's Blog">
<meta name="twitter:description" content="好记性不如烂笔头,更何况记性还不好">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://fujiador.github.io/"/>





  <title> Fujia's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Fujia's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">点滴技术的印记</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/06/01/Python需求：批量解压ZIP文件，并获取简单信息/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/01/Python需求：批量解压ZIP文件，并获取简单信息/" itemprop="url">
                  Python需求：批量解压ZIP文件，并获取简单信息
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-01T00:50:08+08:00">
                2017-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="需求简介"><a href="#需求简介" class="headerlink" title="需求简介"></a>需求简介</h3><p>现在需要获取服务器上某一类文件夹下的全部ZIP文件的创建时间信息，以及ZIP文件内的内容行数信息。服务器上基础的文件层级如下截图：<br><img src="http://on58f12qv.bkt.clouddn.com/%E9%9C%80%E6%B1%82-1.PNG" alt="需求-1|center"><br>其中以“YYYMM”命名的文件均为目标文件夹，“result”文件存放我们中间处理的结果以及放置脚本的位置，这些文件均在某一个固定目录下。其中“YYYYMM”文件夹下均未ZIP压缩文件，如下截图：<br><img src="http://on58f12qv.bkt.clouddn.com/%E9%9C%80%E6%B1%82-2.PNG" alt="需求-2|center"></p>
<p>需要说明的一点，在ZIP文件内，是不定数量的Excel（“.xls”格式，且以中文命名，而且只保证在单个ZIP文件下不重复）文件的压缩包（可能是空文件，也可能有很多个）。</p>
<p>现在的需求即：统计这些ZIP文件的创建时间，ZIP内各Excel的行数信息。</p>
<hr>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>获取某固定目录下的子目录以及各子目录下的ZIP文件列表，依次获取ZIP的创建时间信息。就ZIP文件内各Excel行数信息而言，需要将各ZIP文件解压，之后通过读取Excel获取行数信息。</p>
<p>大致的思路就是上述步骤，接下来是具体的代码实现。</p>
<hr>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><ul>
<li>Ubuntu</li>
<li>Python 2.7.10</li>
</ul>
<p>代码结构如下截图：<br><img src="http://on58f12qv.bkt.clouddn.com/%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84.png" alt="代码结构|center"></p>
<h4 id="解压zip文件"><a href="#解压ZIP文件" class="headerlink" title="解压ZIP文件"></a>解压ZIP文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## Unzip_file.py</span></div><div class="line"><span class="comment">## 实现ZIP文件的自动解压,同时读取各ZIP文件的创建时间</span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'FuJia'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> codecs</div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="comment"># root_dir = '/mnt/home/data/upload'   #此路径为个人路径</span></div><div class="line">root_dir = <span class="string">'/mnt/online-env/upload/file'</span>   <span class="comment"># 此路径为线上环境路径</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dir_list</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">""" 获取指定路径下子目录列表"""</span></div><div class="line">    <span class="keyword">global</span> root_dir</div><div class="line">    <span class="keyword">if</span> os.path.exists(root_dir):</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            dir_list = os.listdir(root_dir)</div><div class="line">            <span class="keyword">return</span> dir_list</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">'The Error &#123;0&#125;.'</span>.format(e)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'The root_dir is not exists.'</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_zip_list</span><span class="params">(target_dir)</span>:</span></div><div class="line">    <span class="string">""" 获取指定子目录下的ZIP文件列表"""</span></div><div class="line">    <span class="keyword">global</span> root_dir</div><div class="line">    target_dir_ = os.path.join(root_dir, target_dir)</div><div class="line">    <span class="keyword">if</span> os.path.exists(target_dir_):</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            zip_list = [zp <span class="keyword">for</span> zp <span class="keyword">in</span> os.listdir(target_dir_)]</div><div class="line">            <span class="keyword">return</span> zip_list</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">'The Error &#123;0&#125;.'</span>.format(e)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'The target_dir &#123;0&#125; is not exists.'</span>.format(target_dir)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">unzip_file</span><span class="params">(target_dir,zip_name)</span>:</span></div><div class="line">    <span class="string">""" 自动化解压ZIP文件功能"""</span></div><div class="line">    <span class="keyword">global</span> root_dir</div><div class="line">    zip_file = os.path.join(root_dir, target_dir, zip_name)</div><div class="line">    <span class="keyword">if</span> os.path.exists(zip_file):</div><div class="line">	    <span class="comment"># root_dir是生产环境,不宜操作.故将数据解压到指定个人路径.</span></div><div class="line">	    <span class="comment"># 因ZIP文件只保证单个ZIP下不重复,因此以ZIP文件的"(*).ZIP"形式创建文件夹,存放对应解压后的Excel文件</span></div><div class="line">        new_dir_path = <span class="string">'/mnt/home/data/upload/result/&#123;0&#125;'</span>.format(zip_name[:<span class="number">-4</span>])</div><div class="line">        os.system(<span class="string">'mkdir &#123;0&#125;'</span>.format(new_dir_path))</div><div class="line">        os.system(<span class="string">'unzip -n -O CP936 &#123;0&#125; -d &#123;1&#125;'</span>.format(zip_file, new_dir_path))</div><div class="line">        <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'The target_dir &#123;0&#125; is not exists.'</span>.format(zip_file)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">        </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_time</span><span class="params">(target_dir, zip_file)</span>:</span></div><div class="line">    <span class="keyword">global</span> root_dir</div><div class="line">    zip_path = os.path.join(root_dir, target_dir, zip_file)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> os.path.exists(zip_path):</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            create_time = os.path.getctime(zip_path)</div><div class="line">            <span class="keyword">return</span>  zip_path[:<span class="number">-4</span>], datetime.fromtimestamp(create_time)</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">'The Error &#123;0&#125;.'</span>.format(e)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'The target_dir &#123;0&#125; is not exists.'</span>.format(zip_path)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    dir_list = get_dir_list()</div><div class="line">	<span class="comment"># 保存ZIP文件创建时间</span></div><div class="line">    file_save = codecs.open(<span class="string">'/mnt/home/data/upload/time_result.txt'</span>, mode=<span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> target_dir <span class="keyword">in</span> dir_list:</div><div class="line">        zip_list = get_zip_list(target_dir)</div><div class="line">        <span class="keyword">for</span> zip_name <span class="keyword">in</span> zip_list:</div><div class="line">            unzip_file(target_dir, zip_name)</div><div class="line">            zip_path, create_time = get_time(target_dir, zip_name)</div><div class="line">            file_save.write( zip_path.decode(<span class="string">'utf-8'</span>) + <span class="string">'\t'</span> + create_time.strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>) +<span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    file_save.close()</div></pre></td></tr></table></figure>
<p>实现代码比较简单，其中备注下在Debug代码过程中踩的坑。<br><strong>k-1</strong></p>
<blockquote>
<p>因为需要操作生成环境下的文件，首先想到的第一步措施可能是将数据文件全部CP或者MV到指定的个人目录下。在这个地方趟的第一个坑，就是CP或MV命令操作ZIP文件之后，其时间就会发生变化，更新为命令动作发生时的时间。所以，选择的方法是在解压ZIP文件的同时，顺道将ZIP文件的创建时间信息获取并保存。</p>
</blockquote>
<p><strong>k-2</strong></p>
<blockquote>
<p>这个算是个小知识吧，不能算坑~。<code>os.listdir()</code>自动过滤指定目录下的当前目录和上级目录，这个在解释器内执行下对应代码即可了解。</p>
</blockquote>
<p><strong>k-3</strong></p>
<blockquote>
<p>前面也已经提到了ZIP内Excel的特征。因为是中文Excel名称，在解压时若直接使用<code>unzip file_name</code>命令，得到的Excel名称是乱码形式，并在下一步的Excel读取行数的过程中无法正常读取。因此调整命令为<code>unzip -O CP936 file_name</code>，完美将解压后中文问题解决。<br>其次，因为ZIP文件内的Excel命名格式只能保证在此ZIP文件下是不重复的，无法保证所有的ZIP下的文件都是不重复的。所以在此，选择了一个比较粗鲁的方案。依据ZIP文件的文成来生成对应的文件夹，同时将指定解压的文件目标路径为上述创建的文件夹中。因此调整命令为<code>unzip -n -d target_path</code>。</p>
</blockquote>
<p>这部分主要逻辑和代码是：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">new_dir_path = <span class="string">'/mnt/home/data/upload/result/&#123;0&#125;'</span>.format(zip_name[:<span class="number">-4</span>])</div><div class="line">os.system(<span class="string">'mkdir &#123;0&#125;'</span>.format(new_dir_path))</div><div class="line">os.system(<span class="string">'unzip -n -O CP936 &#123;0&#125; -d &#123;1&#125;'</span>.format(zip_file, new_dir_path))</div></pre></td></tr></table></figure></p>
<p>到此，解压ZIP文件的工作已经完成。接下来统计Excel行数的工作就比较轻松啦。</p>
<h4 id="统计excel行数"><a href="#统计Excel行数" class="headerlink" title="统计Excel行数"></a>统计Excel行数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line"><span class="comment">## Summary_info.py</span></div><div class="line"><span class="comment">## 统计解压后的Excel文件的行数信息</span></div><div class="line">__author__ = <span class="string">'FuJia'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> xlrd</div><div class="line"><span class="keyword">import</span> codecs</div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="comment"># 个人数据处理路径</span></div><div class="line">root_dir = <span class="string">'/mnt/home/data/upload/result'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dir_list</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">global</span> root_dir</div><div class="line">    <span class="keyword">if</span> os.path.exists(root_dir):</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            dir_list = os.listdir(root_dir)</div><div class="line">            dir_list.pop(dir_list.index(<span class="string">'Summary_info.py'</span>))</div><div class="line">            dir_list.pop(dir_list.index(<span class="string">'Unzip_files.py'</span>))</div><div class="line">            <span class="keyword">return</span> dir_list</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">'The Error &#123;0&#125;.'</span>.format(e)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'The root_dir is not exists.'</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dir_list_</span><span class="params">(target_dir)</span>:</span></div><div class="line">    <span class="keyword">global</span> root_dir</div><div class="line">    dir_ = os.path.join(root_dir, target_dir)</div><div class="line">    <span class="keyword">if</span> os.path.exists(dir_):</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            file_list = os.listdir(dir_)</div><div class="line">            <span class="keyword">return</span> file_list</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">'The Error &#123;0&#125;'</span>.format(e)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'The root_dir is not exists.'</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_time</span><span class="params">(target_dir, excel_file)</span>:</span></div><div class="line">    <span class="keyword">global</span> root_dir</div><div class="line">    excel_path = os.path.join(root_dir, target_dir, excel_file)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> os.path.exists(excel_path):</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            create_time = os.path.getctime(excel_path)</div><div class="line">            <span class="keyword">return</span>  excel_path, datetime.fromtimestamp(create_time)</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">'The Error &#123;0&#125;.'</span>.format(e)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'The target_dir &#123;0&#125; is not exists.'</span>.format(excel_file)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_rows</span><span class="params">(target_dir, excel_file)</span>:</span></div><div class="line">    <span class="keyword">global</span> root_dir</div><div class="line">    excel_path = os.path.join(root_dir, target_dir, excel_file)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> os.path.exists(excel_path):</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            excelFile = xlrd.open_workbook(excel_path.decode(<span class="string">'utf-8'</span>))</div><div class="line">            sheet = excelFile.sheet_by_index(<span class="number">0</span>)</div><div class="line">            nrows = sheet.nrows</div><div class="line">            <span class="keyword">return</span> nrows</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">'The Error &#123;0&#125;.'</span>.format(e)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'The target_dir &#123;0&#125; is not exists.'</span>.format(excel_file)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    dir_list = get_dir_list()</div><div class="line"></div><div class="line">    file_save = codecs.open(<span class="string">'/mnt/home/data/upload/summary_result.txt'</span>, mode=<span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> target_dir <span class="keyword">in</span> dir_list:</div><div class="line">        file_list = get_dir_list_(target_dir)</div><div class="line">        <span class="keyword">if</span> file_list <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">for</span> excel_file <span class="keyword">in</span> file_list:</div><div class="line">                excel_path, create_time = get_time(target_dir, excel_file)</div><div class="line">                nrows = get_rows(target_dir, excel_file)</div><div class="line">                file_save.write( excel_path.decode(<span class="string">'utf-8'</span>) + <span class="string">'\t'</span> + create_time.strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>) + <span class="string">'\t'</span> + str(nrows) + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    file_save.close()</div></pre></td></tr></table></figure>
<p>这部分的代码很简单，只需要稍微注意下<code>xlrd.open_workbook()</code>中文名的Excel即可。</p>
<hr>
<h3 id="to-do"><a href="#To-Do" class="headerlink" title="To-Do"></a>To-Do</h3><ol>
<li>重构代码，两个功能部分的代码还是有很大的相似性，减少代码的冗余，使代码更加通用化</li>
<li>扩展获取文件相关信息的功能</li>
</ol>
<hr>
<h3 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h3><ol>
<li>Python官方 OS 文档</li>
<li>Ubuntu unzip 命令</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/05/30/Python项目：定制化词云/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/30/Python项目：定制化词云/" itemprop="url">
                  Python项目：定制化词云
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-30T22:26:34+08:00">
                2017-05-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h3><p>“词云”是对常见的文本中出现频率较高的“关键词”或“高频词”予以视觉和展示上的突出，形成层次有序、主题突出的“词云”图形，从而过滤掉大量的无意义信息，并凸显想要展示的信息内容。<br>一幅制作精美的词云图片，可以达到一图胜千言的效果，通常在PPT报告中使用漂亮的词云，关键是可以装X~   :）</p>
<p>接下来，将使用<code>wordcloud</code>第三方包来制作词云，并且解决中文字符显示的问题，生成定制化个性词云。</p>
<hr>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li>Python 3.6</li>
</ul>
<hr>
<h3 id="第三方packages"><a href="#第三方Packages" class="headerlink" title="第三方Packages"></a>第三方Packages</h3><ul>
<li>wordcloud</li>
<li>PIL</li>
</ul>
<hr>
<h4 id="wordcloud安装"><a href="#wordcloud安装" class="headerlink" title="wordcloud安装"></a>wordcloud安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple wordcloud</div></pre></td></tr></table></figure>
<p>Windows环境下，推荐从<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/" target="_blank" rel="external">非官方Windows第三方库</a>下载安装。<br><img src="http://on58f12qv.bkt.clouddn.com/Unoffical_wordcloud.PNG" alt="wordcloud|center"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install C:\Users\Desktop\wordcloud-1.3.1-cp36-cp36m-win_amd64.whl</div></pre></td></tr></table></figure></p>
<p><code>Unofficial Windows Binaries for Python Extension Packages</code>可以高效的在windows环境下安装第三方包，并且避免pip安装过程中莫名其妙的坑。</p>
<p><strong>wordcloud</strong><a href="https://github.com/amueller/word_cloud" target="_blank" rel="external">GitHub</a>。wordcloud作者是使用Python2+编写，但是Python3+也是兼容的。</p>
<h3 id="实例代码"><a href="#实例代码" class="headerlink" title="实例代码"></a>实例代码</h3><p>官方Git展示的简单示例，将《美国宪法》生成词云。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'FuJia'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> codecs</div><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</div><div class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line">FILE_PATH = path.dirname(__file__)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_text</span><span class="params">(FILE_NAME)</span>:</span></div><div class="line">	<span class="keyword">global</span> FILE_PATH</div><div class="line">	file_path = path.join(FILE_PATH, FILE_NAME)</div><div class="line">	<span class="keyword">try</span>:</div><div class="line">		<span class="keyword">with</span> codecs.open(file_path, mode=<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</div><div class="line">			text = file.read()</div><div class="line">		<span class="keyword">return</span> text</div><div class="line">	<span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> e:</div><div class="line">		print(<span class="string">"FileNot Found ,&#123;&#125;"</span>.format(e))</div><div class="line">		<span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_wordcloud</span><span class="params">(text,)</span>:</span></div><div class="line">	wordcloud = WordCloud(max_font_size=<span class="number">40</span>).generate(text)</div><div class="line"></div><div class="line">	plt.imshow(wordcloud, interpolation=<span class="string">'bilinear'</span>)</div><div class="line">	plt.axis(<span class="string">"off"</span>)</div><div class="line">	plt.show()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">	FILE_NAME = <span class="string">'US_constitution.txt'</span></div><div class="line">	text = load_text(FILE_NAME)</div><div class="line"></div><div class="line">	generate_wordcloud(text)</div></pre></td></tr></table></figure></p>
<p>下图是生成的《美国宪法》默认样式参数的词云图。<br><img src="http://on58f12qv.bkt.clouddn.com/US_constitution.txt.jpeg" alt="美国宪法-词云|center"></p>
<p><code>wordcloud</code>包的核心是<code>WordCloud</code>类，用于生成和绘制WordCloud对象。<br><strong>参数：</strong></p>
<ul>
<li>font_path  要使用的字体的路径（OTF或TTF文件）</li>
<li>width  画布宽度，默认400</li>
<li>heifht  画布高度，默认200</li>
<li>prefer_horizontal </li>
<li>mask </li>
<li>scale 缩放，默认1</li>
<li>min_font_size 使用最小的字体大小，默认4</li>
<li>font_step 字体的步长大小，morning1</li>
<li>max_words 最大字数，默认200</li>
<li>stopwords  禁用词，默认内置的STOPWORDS列表</li>
<li>background_color 词云图像的北京颜色，默认black</li>
<li>max_font_size 最大字体的字体大小</li>
<li>mode 模式，默认RGB，当mode=RGBA时，产生透明背景</li>
<li>relative_scaling</li>
<li>color_func callable，default=None。一般使用Image的generate_image方法获取图片的颜色设置</li>
<li>colormap 色彩映射将每个单词随机绘制颜色</li>
</ul>
<p>在上面的代码中，当输入中文格式的文本时，是不能正常显示的中文的。如下图所示：<br><img src="http://on58f12qv.bkt.clouddn.com/%E4%B8%AD%E6%96%87%E9%97%AE%E9%A2%98.png" alt="中文问题|center"></p>
<p>因为WordCloud类中font_path参数变量没有找到显示中文的字体。通过WordCloud的参数说明，可以用font_path参数来设置可显示中文的字体。并将对应部分的代码进行如下调整：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_wordcloud</span><span class="params">(text, save_name, font_name=None)</span>:</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> font_path:</div><div class="line">        wordcloud = WordCloud(max_font_size=<span class="number">40</span>).generate(text) </div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        wordcloud = WordCloud(font_path=path.join(FILE_PATH,font_name),max_font_size=<span class="number">40</span>).generate(text)</div><div class="line"></div><div class="line">    plt.imshow(wordcloud, interpolation=<span class="string">'bilinear'</span>)</div><div class="line">    plt.axis(<span class="string">"off"</span>)</div><div class="line">    plt.savefig(save_name+<span class="string">".jpeg"</span>)</div><div class="line">    plt.show()</div></pre></td></tr></table></figure></p>
<p>调整之后的词云结果如下：<br><img src="http://on58f12qv.bkt.clouddn.com/%E6%AD%A3%E5%B8%B8%E6%98%BE%E7%A4%BA.png" alt="解决中文问题|center"></p>
<hr>
<h3 id="奇形怪状的词云"><a href="#奇形怪状的词云" class="headerlink" title="奇形怪状的词云"></a>奇形怪状的词云</h3><p>接下来，我们绘制定制图形的词云！git官方的实例，是关于爱丽丝的一个词云。</p>
<h4 id="代码实例"><a href="#代码实例" class="headerlink" title="代码实例"></a>代码实例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'MaFuJia'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> codecs</div><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</div><div class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud,STOPWORDS</div><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">FILE_PATH = path.dirname(__file__)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_text</span><span class="params">(FILE_NAME)</span>:</span></div><div class="line">	<span class="keyword">global</span> FILE_PATH</div><div class="line">	file_path = path.join(FILE_PATH, FILE_NAME)</div><div class="line">	<span class="keyword">try</span>:</div><div class="line">		<span class="keyword">with</span> codecs.open(file_path, mode=<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</div><div class="line">			text = file.read()</div><div class="line">		<span class="keyword">return</span> text</div><div class="line">	<span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> e:</div><div class="line">		print(<span class="string">"FileNot Found ,&#123;&#125;"</span>.format(e))</div><div class="line">		<span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_wordcloud</span><span class="params">(text, save_name, font_name=None, mask_name=None)</span>:</span></div><div class="line">	<span class="keyword">global</span> FILE_PATH</div><div class="line"></div><div class="line">	image_mask = np.array(Image.open(path.join(FILE_PATH,mask_name)))</div><div class="line">	stopwords = set(STOPWORDS)</div><div class="line">	stopwords.add(<span class="string">"said"</span>)</div><div class="line"></div><div class="line">	wordcloud = WordCloud(background_color=<span class="string">'white'</span>, max_words=<span class="number">2000</span>, mask=image_mask,</div><div class="line">	                            stopwords=stopwords,font_path=path.join(FILE_PATH,font_name))</div><div class="line">	wordcloud.generate(text)</div><div class="line"></div><div class="line">	wordcloud.to_file(path.join(FILE_PATH, save_name.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.png'</span>))</div><div class="line">	plt.imshow(wordcloud, interpolation=<span class="string">'bilinear'</span>, cmap=plt.cm.gray)</div><div class="line">	plt.axis(<span class="string">"off"</span>)</div><div class="line">	plt.savefig(path.join(FILE_PATH, save_name.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.png'</span>))</div><div class="line">	plt.show()</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">	FILE_NAME = <span class="string">'alice.txt'</span></div><div class="line">	text = load_text(FILE_NAME)</div><div class="line"></div><div class="line">	generate_wordcloud(text, FILE_NAME, font_name=<span class="string">'simhei.ttf'</span>, mask_name=<span class="string">'alice_mask.png'</span>)</div></pre></td></tr></table></figure>
<p>效果图如下所示：<br><img src="http://on58f12qv.bkt.clouddn.com/alice.png" alt="alice|center|800*0"></p>
<p>最核心的一个参数是<code>mask=image_mask</code>，设置一个图片轮廓作为词云的mask，让我们的单词只在这个mask的空间内进行展示。</p>
<hr>
<h3 id="to-do"><a href="#To-Do" class="headerlink" title="To-Do"></a>To-Do</h3><ol>
<li>代码重构</li>
<li>参数添加，更加通用化</li>
<li>可否制作成可安装的exe小程序</li>
</ol>
<hr>
<h3 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h3><p><a href="https://github.com/amueller/word_cloud" target="_blank" rel="external">https://github.com/amueller/word_cloud</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/05/22/Python项目：小说汉字统计/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/22/Python项目：小说汉字统计/" itemprop="url">
                  Python项目：小说汉字统计
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-22T22:26:17+08:00">
                2017-05-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h3><p>这个练手代码实际不能称为“项目”的，因为实在是太简单，并且没有实质的干货内容。这篇博客仅仅是做一个小小的记录，在过程的一些坑做一个小备忘。：)</p>
<hr>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li>Python 2.7.10</li>
<li>文本素材：随便一本小说即可(注意文本数据的编码UTF-8)</li>
</ul>
<hr>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>大的方向即：获取文件的内容，并高效的拆分单个汉字，简单统计各个汉字在小说文件中出现的次数（没有什么实质意义）。将统计结果排序，并且查看在小说文件中最长见的Top-N汉字，并将统计结果数据保存。</p>
<hr>
<h4 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/ - <span class="comment"># 根目录</span></div><div class="line">  -	./data</div><div class="line">  - main.py</div></pre></td></tr></table></figure>
<hr>
<h4 id="详细代码"><a href="#详细代码" class="headerlink" title="详细代码"></a>详细代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># main.py 代码</span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'FuJia'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> codecs</div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Characters_Summary</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="keyword">global</span> stop_characters</div><div class="line">	</div><div class="line">	stop_characters = [<span class="string">''</span>,<span class="string">'\t'</span>,<span class="string">'\n'</span>,<span class="string">'.'</span>,<span class="string">','</span>,<span class="string">'?'</span>,<span class="string">'!'</span>,<span class="string">'('</span>,<span class="string">')'</span>,<span class="string">':'</span>,<span class="string">'&#123;'</span>,<span class="string">'&#125;'</span>,<span class="string">';'</span>,<span class="string">'/'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">'．'</span>,<span class="string">'＋'</span>,<span class="string">'—'</span>,<span class="string">''</span>,<span class="string">'\r\n'</span>,<span class="string">'"'</span>,<span class="string">'*'</span>,<span class="string">'-'</span>,<span class="string">u'。'</span>,<span class="string">u'，'</span>,<span class="string">u'？'</span>,<span class="string">u'！'</span>,<span class="string">u'（'</span>,<span class="string">u'）'</span>,<span class="string">u'：'</span>,<span class="string">u'；'</span>,<span class="string">u'《'</span>,<span class="string">u'》'</span>,<span class="string">u'’'</span>,<span class="string">u'‘'</span>,<span class="string">u''</span>,<span class="string">u'【'</span>,<span class="string">u'】'</span>,<span class="string">u'、'</span>,<span class="string">u'￥'</span>,<span class="string">u'“'</span>,<span class="string">u'…'</span>,<span class="string">u'”'</span>,<span class="string">u'*'</span>,<span class="string">u'-'</span>,<span class="string">u''</span>]</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, file_in_path)</span>:</span></div><div class="line">		self.stop_characters = stop_characters</div><div class="line">		self.file_in_path = file_in_path</div><div class="line">		self.characters_dict = self.main()</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></div><div class="line">		characters_dict = Counter()</div><div class="line">		<span class="keyword">try</span>:</div><div class="line">			<span class="keyword">with</span> codecs.open(self.file_in_path, mode=<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</div><div class="line">				<span class="keyword">for</span> line <span class="keyword">in</span> file:</div><div class="line">					line = line.strip()</div><div class="line">					<span class="keyword">if</span> <span class="keyword">not</span> line:</div><div class="line">						<span class="keyword">continue</span></div><div class="line">					<span class="keyword">else</span>:</div><div class="line">						<span class="keyword">for</span> idx,character <span class="keyword">in</span> enumerate(line):</div><div class="line">							<span class="keyword">if</span> character <span class="keyword">not</span> <span class="keyword">in</span> self.stop_characters <span class="keyword">and</span> <span class="keyword">not</span> re.search(<span class="string">r'[0-9]|[A-Z]'</span>,character,re.S):</div><div class="line">								characters_dict[character] += <span class="number">1</span></div><div class="line">			<span class="keyword">return</span> characters_dict</div><div class="line">		<span class="keyword">except</span> Exception,e:</div><div class="line">			<span class="keyword">print</span> <span class="string">'Error Information :'</span>,e</div><div class="line">			<span class="keyword">return</span> dict()</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">sort_</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">if</span> <span class="keyword">not</span> self.characters_dict:</div><div class="line">			<span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			characters_dict_sorted = sorted(self.characters_dict.iteritems(), key=<span class="keyword">lambda</span> d:d[<span class="number">1</span>], reverse=<span class="keyword">True</span>)</div><div class="line">			<span class="keyword">return</span> characters_dict_sorted</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">most_comm</span><span class="params">(self, top=None)</span>:</span></div><div class="line">		<span class="keyword">if</span> <span class="keyword">not</span> self.characters_dict:</div><div class="line">			<span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			<span class="keyword">return</span> self.characters_dict.most_common(top)</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">save_txt</span><span class="params">(self, file_save_path)</span>:</span></div><div class="line">		<span class="keyword">if</span> <span class="keyword">not</span> self.characters_dict:</div><div class="line">			<span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			<span class="keyword">if</span> isinstance(self.characters_dict, dict):</div><div class="line">				<span class="keyword">with</span> codecs.open(file_save_path, mode=<span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</div><div class="line">					<span class="keyword">for</span> character, cnt <span class="keyword">in</span> self.characters_dict.iteritems():</div><div class="line">						file.write(character + <span class="string">'\t'</span> + str(cnt) + <span class="string">'\n'</span>)</div><div class="line">			<span class="keyword">elif</span> isinstance(self.characters_dict, list):</div><div class="line">				<span class="keyword">with</span> codecs.open(file_save_path, mode=<span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</div><div class="line">					<span class="keyword">for</span> tuple_ <span class="keyword">in</span> self.characters_dict:</div><div class="line">						character, cnt = tuple_</div><div class="line">						file.write(character + <span class="string">'\t'</span> + str(cnt) + <span class="string">'\n'</span>)</div><div class="line">			<span class="keyword">return</span> <span class="keyword">True</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">save_json</span><span class="params">(self, file_save_path)</span>:</span></div><div class="line">		<span class="keyword">if</span> <span class="keyword">not</span> self.characters_dict:</div><div class="line">			<span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			<span class="keyword">with</span> codecs.open(file_save_path, mode=<span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</div><div class="line">				file.write(json.dumps(self.characters_dict))</div><div class="line">			<span class="keyword">return</span> <span class="keyword">True</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">	characters = Characters_Summary(<span class="string">'./data/novel.txt'</span>)</div><div class="line"></div><div class="line">	characters.most_comm(top=<span class="number">50</span>)</div><div class="line">	characters.save_txt(<span class="string">'./data/out_txt.txt'</span>)</div><div class="line">	characters.save_json(<span class="string">'./data/out_json.json'</span>)</div></pre></td></tr></table></figure>
<hr>
<h4 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h4><ol>
<li>小说文本数据，推荐使用UTF-8编码，并且注意编辑器所对应的编码设置。在Python2.7中常见的编码解码问题</li>
<li>停用标点符号的清洗和过滤，配合正则表达式使用</li>
<li>dict数据结构，通过<code>sorted(dict.iteritems(), key=lambda d:d[1], reverse=True)</code>排序后返回的数据是list类型，因为dict是无序的，若要排序，就需要数据类型可排序</li>
</ol>
<h4 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h4><ol>
<li>Counter()类及其方法的使用，高效便捷！</li>
</ol>
<h3 id="to-do"><a href="#To-Do" class="headerlink" title="To-Do"></a>To-Do</h3><ol>
<li>单个汉字统计，没有实质的信息，后续通过分词并在其基础上，进一步探索</li>
<li>在停用标点符号过滤部分代码，提示一个警告：’UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal<br>if character not in self.stop_characters and not re.search(r’[0-9]|[A-Z]’,character,re.S)’<br>这个警告主要因为停用标点符号中有字符无法将其转换为Unicode，不能正常的判定是否需要过滤操作。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/05/16/数据需求-转换Excel数据形式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/16/数据需求-转换Excel数据形式/" itemprop="url">
                  [数据需求] 转换Excel数据形式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T21:58:13+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="需求说明"><a href="#需求说明" class="headerlink" title="需求说明"></a>需求说明</h3><p>这个数据需求来自Q群水友：期望将Excel内各行的文本数据，转化为表格形式的数据以方便统计。</p>
<p>常规的Excel函数或多次分列、VBA、可以进行处理，现在用Python来解决实现这一需求。</p>
<p>需求数据示例如下：<br><img src="http://on58f12qv.bkt.clouddn.com/%E6%95%B0%E6%8D%AE%E9%9C%80%E6%B1%82.png" alt="数据需求|center"></p>
<p>数据格式比较规律，分别以”,”分隔为一组数据tuple，tuple内部以不定长空格进行分隔字段fields。</p>
<p>处理转化为结果示例如下：<br><img src="http://on58f12qv.bkt.clouddn.com/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%9C.png" alt="需求结果|center"></p>
<hr>
<h3 id="python实现"><a href="#Python实现" class="headerlink" title="Python实现"></a>Python实现</h3><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><p>python version：2.7.10<br>系统：windows</p>
<h4 id="第三方package"><a href="#第三方Package" class="headerlink" title="第三方Package"></a>第三方Package</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pip install xlsxwriter</div><div class="line">pip install pandas</div></pre></td></tr></table></figure>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line"><span class="string">""" Transform the Excel Data.</span></div><div class="line">"""</div><div class="line">__author__ = <span class="string">'FuJia'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> xlsxwriter</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_Data</span><span class="params">(file_in, sheetname=<span class="number">0</span>)</span>:</span></div><div class="line">	df = pd.read_excel(file_in, sheetname=sheetname)</div><div class="line">	data = []</div><div class="line">	<span class="keyword">for</span> line <span class="keyword">in</span> df[df.columns[<span class="number">1</span>]]:</div><div class="line">		data.append(line)</div><div class="line">	<span class="keyword">return</span> data</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_workbook</span><span class="params">(workbook_name, sheet_name)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        workbook = xlsxwriter.Workbook((workbook_name + <span class="string">".xlsx"</span>))</div><div class="line">        worksheet = workbook.add_worksheet(sheet_name)</div><div class="line">        <span class="keyword">print</span> <span class="string">"the %s excel workbook has been created successfully!"</span> % (workbook_name + <span class="string">".xlsx"</span>)</div><div class="line">        <span class="keyword">return</span> workbook,worksheet</div><div class="line">    <span class="keyword">except</span> Exception,e:</div><div class="line">        <span class="keyword">print</span> e</div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_title</span><span class="params">(worksheet, title_lists, row=<span class="number">1</span>, col=<span class="number">0</span>, title_format=None)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">for</span> i,title <span class="keyword">in</span> enumerate(title_lists):</div><div class="line">            <span class="keyword">if</span> title:</div><div class="line">                worksheet.write(row, col+i, title, title_format)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">break</span></div><div class="line">    <span class="keyword">except</span> Exception,e:</div><div class="line">        <span class="keyword">return</span> e</div><div class="line">    <span class="keyword">print</span> <span class="string">"Done Successful!"</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_style</span><span class="params">(workbook)</span>:</span></div><div class="line">    <span class="keyword">if</span> workbook:</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            title_formats = workbook.add_format(&#123;<span class="string">'bold'</span>:<span class="keyword">True</span>, <span class="string">'bg_color'</span>:<span class="string">'#B0C4DE'</span>, <span class="string">'font_size'</span>:<span class="number">10</span>, <span class="string">'font_name'</span>:<span class="string">'Microsoft yahei'</span>&#125;)</div><div class="line">            cell_formats = workbook.add_format(&#123;<span class="string">'bold'</span>:<span class="keyword">False</span>,<span class="string">'font_size'</span>:<span class="number">10</span>, <span class="string">'font_name'</span>:<span class="string">'Microsoft yahei'</span>&#125;)</div><div class="line">            date_formats = workbook.add_format(&#123;<span class="string">'bold'</span>:<span class="keyword">False</span>,<span class="string">'font_size'</span>:<span class="number">10</span>, <span class="string">'font_name'</span>:<span class="string">'Microsoft yahei'</span>, <span class="string">'num_format'</span>: <span class="string">'yyyy-mm-dd'</span>&#125;)</div><div class="line">            <span class="keyword">return</span> title_formats,cell_formats,date_formats</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">"the workbook object is invalid, please check the workbook object!"</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"please check and input the correct workbook object!"</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_data</span><span class="params">(worksheet,data,row=<span class="number">2</span>,col=<span class="number">0</span>)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        i = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> data:</div><div class="line">            j = <span class="number">0</span></div><div class="line">            <span class="keyword">for</span> tp <span class="keyword">in</span> line.split(<span class="string">','</span>):</div><div class="line">                name,count,amount = tp.split()</div><div class="line">                worksheet.write(row+i,col+<span class="number">0</span> + j*<span class="number">3</span>,name)</div><div class="line">                worksheet.write(row+i,col+<span class="number">1</span> + j*<span class="number">3</span>,count)</div><div class="line">                worksheet.write(row+i,col+<span class="number">2</span> + j*<span class="number">3</span> ,amount)</div><div class="line">                j +=<span class="number">1</span></div><div class="line">            i += <span class="number">1</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"The data has been write into excel worksheet object successfully!"</span></div><div class="line">    <span class="keyword">except</span> Exception,e:</div><div class="line">        <span class="keyword">print</span> <span class="string">"please check the data's content!"</span></div><div class="line">    <span class="keyword">return</span> None3</div><div class="line">   </div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    file_in = <span class="string">r'test.xlsx'</span></div><div class="line">    title_lists = [<span class="string">u'姓名'</span>,<span class="string">u'数量'</span>,<span class="string">u'金额'</span>] * <span class="number">3</span></div><div class="line">	data = get_data(file_in)</div><div class="line"></div><div class="line">	workbook,worksheet = create_workbook( <span class="string">'out'</span>, <span class="string">'sheet1'</span>)</div><div class="line">	title_formats,cell_formats,_ = format_style(workbook)</div><div class="line">	write_title(worksheet, title_lists, row=<span class="number">1</span>, col=<span class="number">1</span>, title_format=title_formats)</div><div class="line">	write_data(worksheet,data,row=<span class="number">2</span>,col=<span class="number">1</span>, cell_format=cell_formats)</div><div class="line">	workbook.close()</div></pre></td></tr></table></figure>
<hr>
<h3 id="to-do"><a href="#To-Do" class="headerlink" title="To-Do"></a>To-Do</h3><ul>
<li>1.代码重构</li>
<li>2.通用性</li>
</ul>
<h3 id="代码重构"><a href="#代码重构" class="headerlink" title="代码重构"></a>代码重构</h3><h4 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h4><p><img src="http://on58f12qv.bkt.clouddn.com/Excel_Temp%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84.png" alt="代码结构|center"></p>
<p>‘data’ 文件夹存放输入和输出数据文件。<br>‘Excel_Object’ 存放Excel类及实例结构和操作方法。<br>‘main’ 处理数据的主函数。<br>‘transform’ 代码重构前函数式、流水操作式代码。</p>
<h4 id="详细代码"><a href="#详细代码" class="headerlink" title="详细代码"></a>详细代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="comment">###  Excel_Object.py</span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'MaFuJia'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> xlsxwriter</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Excel_Operator</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, workbook_name, worksheet_name)</span>:</span></div><div class="line">        self.workbook_name = workbook_name</div><div class="line">        self.worksheet_name = worksheet_name</div><div class="line">        self.workbook = xlsxwriter.Workbook(self.workbook_name + <span class="string">".xlsx"</span>)</div><div class="line">        self.worksheet = self.workbook.add_worksheet(self.worksheet_name)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format_style</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.workbook:</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                title_formats = self.workbook.add_format(&#123;<span class="string">'bold'</span>:<span class="keyword">True</span>, <span class="string">'bg_color'</span>:<span class="string">'#B0C4DE'</span>, <span class="string">'font_size'</span>:<span class="number">10</span>, <span class="string">'font_name'</span>:<span class="string">'Microsoft yahei'</span>&#125;)</div><div class="line">                cell_formats = self.workbook.add_format(&#123;<span class="string">'bold'</span>:<span class="keyword">False</span>,<span class="string">'font_size'</span>:<span class="number">10</span>, <span class="string">'font_name'</span>:<span class="string">'Microsoft yahei'</span>&#125;)</div><div class="line">                date_formats = self.workbook.add_format(&#123;<span class="string">'bold'</span>:<span class="keyword">False</span>,<span class="string">'font_size'</span>:<span class="number">10</span>, <span class="string">'font_name'</span>:<span class="string">'Microsoft yahei'</span>, <span class="string">'num_format'</span>: <span class="string">'yyyy-mm-dd'</span>&#125;)</div><div class="line">                <span class="keyword">return</span> title_formats,cell_formats,date_formats</div><div class="line">            <span class="keyword">except</span> Exception,e:</div><div class="line">                <span class="keyword">print</span> <span class="string">"the workbook object is invalid, please check the workbook object."</span></div><div class="line">                <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">"please check and input the correct workbook object!"</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_title</span><span class="params">(self, title_lists, row=<span class="number">0</span>, col=<span class="number">0</span>, title_format=None)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">for</span> i, title <span class="keyword">in</span> enumerate(title_lists):</div><div class="line">                <span class="keyword">if</span> title:</div><div class="line">                    self.worksheet.write(row, col+i, title, title_format)</div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">break</span></div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> e</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"The titles has been write into excel worksheet object successfully!"</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_data</span><span class="params">(self, data, row=<span class="number">0</span>, col=<span class="number">0</span>, cell_format=None)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            i = <span class="number">0</span></div><div class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> data:</div><div class="line">                j = <span class="number">0</span></div><div class="line">                <span class="keyword">for</span> tp <span class="keyword">in</span> line.split(<span class="string">','</span>):</div><div class="line">                    name, count, amount = tp.split()</div><div class="line">                    self.worksheet.write(row+i,col+<span class="number">0</span> + j*<span class="number">3</span>,name, cell_format)</div><div class="line">                    self.worksheet.write(row+i,col+<span class="number">1</span> + j*<span class="number">3</span>,count, cell_format)</div><div class="line">                    self.worksheet.write(row+i,col+<span class="number">2</span> + j*<span class="number">3</span> ,amount, cell_format)</div><div class="line">                    j += <span class="number">1</span></div><div class="line">                i += <span class="number">1</span></div><div class="line">            <span class="keyword">print</span> <span class="string">"The data has been write into excel worksheet object successfully!"</span></div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">"please check the data's content!"</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></div><div class="line">        self.workbook.close()</div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### main.py</span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'MaFuJia'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">from</span> Excel_Object <span class="keyword">import</span> Excel_Operator</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span><span class="params">(file_in, sheetname=<span class="number">0</span>)</span>:</span></div><div class="line">    df = pd.read_excel(file_in, sheetname)</div><div class="line">    data = []</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> df[df.columns[<span class="number">1</span>]]:</div><div class="line">        data.append(line)</div><div class="line">    <span class="keyword">return</span> data</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(data, title_lists)</span>:</span></div><div class="line">    Excel_obj = Excel_Operator(<span class="string">'./data/out'</span>, <span class="string">'sheet1'</span>)</div><div class="line"></div><div class="line">    title_formats,cell_formats,_ = Excel_obj.format_style()</div><div class="line"></div><div class="line">    Excel_obj.write_title( title_lists, row=<span class="number">1</span>, col=<span class="number">1</span>, title_format=title_formats)</div><div class="line">    Excel_obj.write_data(data,row=<span class="number">2</span>,col=<span class="number">1</span>, cell_format=cell_formats)</div><div class="line">    Excel_obj.close()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line"></div><div class="line">    title_lists = [<span class="string">u'姓名'</span>,<span class="string">u'数量'</span>,<span class="string">u'金额'</span>] * <span class="number">3</span></div><div class="line">    data = get_data(<span class="string">'./data/test.xlsx'</span>)</div><div class="line"></div><div class="line">    main(data, title_lists)</div></pre></td></tr></table></figure>
<hr>
<h3 id="to-do"><a href="#To-DO" class="headerlink" title="To-DO"></a>To-DO</h3><ul>
<li><ol>
<li>功能代码通用化</li>
</ol>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/05/14/Python项目：IP地址信息可视化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/14/Python项目：IP地址信息可视化/" itemprop="url">
                  Python项目：IP地址信息可视化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-14T21:33:21+08:00">
                2017-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h3><p>无论对于任何的互联网企业，“用户”是企业最最核心的资源。因此在用户经营管理的工作中，对“用户”的分析，是不可或缺的一个环节。</p>
<p>分析的角度非常多，其中包括“用户地域分布信息”的分析。针对用户地域信息分布的数据，不仅仅是进行单纯的统计，更是在后续的决策、推广、拓展中起到非常重要的指导作用。</p>
<p>通常，可以通过接入API服务（例如高德、谷歌地图等），或者购买第三方IP查询服务（例如常见的IP查询功能网址），以及当前市面上“纯真IP数据库”，或者使用免费API查询IP信息（通常有使用次数限制）。</p>
<p>现在，我们以“节约成本”为前提，以“数据尽量准确”为目的，通过使用“纯真IP数据库”实现用户IP地址位置信息查询的项目。</p>
<hr>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li>MySQL 5.7 </li>
<li>Python 2.7.10</li>
<li><a href="http://www.cz88.net/" target="_blank" rel="external">纯真IP数据库</a></li>
</ul>
<p>感谢CZ88提供的查询IP服务，并将其开发为一款小巧便捷的插件。我们这个项目的目的是自动化更新IP地址信息。接下来，开始详细项目内容。</p>
<hr>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>结合纯真IP数据库提供的数据信息，以及IP的基础知识，总体的思路就是：首先，将IP地址转化为数字字段，并将其与IP库内的IP地址段进行比较，以初步确定IP地址信息；然后，对IP数据进行数据库的读写操作、更新数据；最后，将IP地址信息进行统计并借助Echart进行可视化。</p>
<hr>
<h4 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h4><p><img src="http://on58f12qv.bkt.clouddn.com/IP_Store%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84.png" alt="代码结构|center|300*0"></p>
<ol>
<li><p>Data 数据准备<br>“qqwry.dat”  是纯真数据库setup之后在安装目录下的IP库文件，是本项目的核心数据。<br>“ip_data.txt” 是需要处理的IP数据，是本项目的需求数据。<br>“ip_data_address.txt”是更新address信息后的ip_data数据。</p>
</li>
<li><p>Utils 工具准备<br>“mysql.config” 是数据库相关的连接信息。<br>“mysql_utils” 是操作MySQL数据库相关类和方法。<br>“load_ip_data” 是需求数据导入MySQL数据相关的方法。<br>“update_ip_address” 是更新MySQL数据相关的方法。<br>“IP_Locator” 是本项目的核心代码，读取纯真IP库、转换IP数据、查询IP地址信息。<br>“ChinaMap_JS” 是Echart官网Map地图生成相关代码。<br>“china_map_summary” 是处理IP地址信息相关代码。</p>
</li>
<li><p>纯真IP库<br>纯真IP库即“qqwry.dat”是十六进制的内容，其内容结构是：</p>
</li>
</ol>
<ul>
<li>start_ip , end_ip , address_info<br>如下截图所示：<br><img src="http://on58f12qv.bkt.clouddn.com/%E7%BA%AF%E7%9C%9FIP%E5%BA%93.png" alt="纯真IP库内容|center"></li>
</ul>
<hr>
<h4 id="详细代码"><a href="#详细代码" class="headerlink" title="详细代码"></a>详细代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">; MySQL数据库配置文件</div><div class="line">[platform_database]</div><div class="line">outer_host = 127.0.0.1</div><div class="line">inner_host = localhost</div><div class="line">user = user</div><div class="line">password = password</div><div class="line">db = database</div><div class="line">charset = utf8</div><div class="line">port = 3308</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'FuJia'</span></div><div class="line"><span class="string">""" MySQL数据库相关的工具包,包含配置信息管理、数据库连接、数据查询、数据更新、数据写入功能.</span></div><div class="line">"""</div><div class="line"><span class="keyword">import</span> MySQLdb</div><div class="line"><span class="keyword">import</span> ConfigParser</div><div class="line"><span class="keyword">import</span> sys,os</div><div class="line"></div><div class="line">__all__ = [<span class="string">'MySQL_Config'</span>, <span class="string">'connect'</span>, <span class="string">'select'</span>, <span class="string">'insert'</span>,<span class="string">'update'</span>]</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySQL_Utils</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, cfg_path, section)</span>:</span></div><div class="line">		self.cfg_path = cfg_path</div><div class="line">		self.section = section</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">MySQL_Config</span><span class="params">(self)</span>:</span></div><div class="line">		config_info = []</div><div class="line">		conf = ConfigParser.ConfigParser()</div><div class="line">		conf.read(self.cfg_path)</div><div class="line">		options = conf.options(self.section)</div><div class="line"></div><div class="line">		<span class="keyword">if</span> sys.platform.find(<span class="string">"win"</span>) &gt;= <span class="number">0</span>:</div><div class="line">			options.pop(options.index(<span class="string">"inner_host"</span>))</div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			options.pop(options.index(<span class="string">"outer_host"</span>))</div><div class="line"></div><div class="line">		<span class="keyword">for</span> option <span class="keyword">in</span> options:</div><div class="line">			config_info.append(conf.get(self.section, option))</div><div class="line">		<span class="keyword">return</span> config_info</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">(self)</span>:</span></div><div class="line">		host, user, passwd, db, charset, port = self.MySQL_Config()</div><div class="line">		self.conn = MySQLdb.connect(host=host, user=user, passwd=passwd,</div><div class="line">		                                db=db, charset=charset, port=int(port))</div><div class="line">		self.cur = self.conn.cursor()</div><div class="line">		<span class="keyword">return</span> self.conn, self.cur</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">(self, select_sql)</span>:</span></div><div class="line">		<span class="keyword">if</span> select_sql:</div><div class="line">			conn, cur = self.connect()</div><div class="line">			<span class="keyword">try</span>:</div><div class="line">				cur.execute(select_sql)</div><div class="line">				data = cur.fetchall()</div><div class="line">				conn.close()</div><div class="line">				<span class="keyword">return</span> data</div><div class="line">			<span class="keyword">except</span> Exception,e:</div><div class="line">				<span class="keyword">print</span> e</div><div class="line">				<span class="keyword">return</span> (<span class="string">''</span>,)</div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			<span class="keyword">print</span> <span class="string">"Please input the correct select_sql!"</span></div><div class="line">			<span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, insert_sql)</span>:</span></div><div class="line">		<span class="keyword">if</span> insert_sql:</div><div class="line">			conn, cur = self.connect()</div><div class="line">			<span class="keyword">try</span>:</div><div class="line">				cur.execute(insert_sql)</div><div class="line">				conn.commit()</div><div class="line">				conn.close()</div><div class="line">				<span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">			<span class="keyword">except</span> Exception,e:</div><div class="line">				conn.rollback()</div><div class="line">				conn.close()</div><div class="line">				<span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			<span class="keyword">print</span> <span class="string">"Please input the correct insert_sql!"</span></div><div class="line">			<span class="keyword">return</span> <span class="keyword">False</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self,update_sql)</span>:</span></div><div class="line">		<span class="keyword">if</span> update_sql:</div><div class="line">			conn, cur = self.connect()</div><div class="line">			<span class="keyword">try</span>:</div><div class="line">				cur.execute(update_sql)</div><div class="line">				conn.commit()</div><div class="line">				conn.close()</div><div class="line">				<span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">			<span class="keyword">except</span> Exception,e:</div><div class="line">				conn.rollback()</div><div class="line">				conn.close()</div><div class="line">				<span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			<span class="keyword">print</span> <span class="string">"Please input the correct update_sql!"</span></div><div class="line">			<span class="keyword">return</span> <span class="keyword">False</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line"></div><div class="line">	cfg_path = os.path.dirname(os.path.abspath(__file__)) + os.path.sep + <span class="string">'mysql.config'</span></div><div class="line">	section = <span class="string">'platform_database'</span></div><div class="line"></div><div class="line">	cfg = MySQL_Utils(cfg_path, section)</div><div class="line">	<span class="keyword">print</span> cfg.connect()</div><div class="line">	cfg.insert(<span class="string">"insert into customers_ip_info(ip) values ('111.200.54.38');"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### load_ip_data.py </span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'FuJia'</span></div><div class="line"><span class="string">""" 将ip_data.txt数据入库到Database的customers_ip_info.</span></div><div class="line">"""</div><div class="line"><span class="keyword">from</span> IP_Store.utils.mysql_utils <span class="keyword">import</span> MySQL_Utils</div><div class="line"><span class="keyword">import</span> codecs,os,time</div><div class="line"></div><div class="line">CFG_PATH = os.path.dirname(os.path.abspath(__file__)) + os.path.sep + <span class="string">'mysql.config'</span></div><div class="line">SECTION = <span class="string">'platform_database'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">mysql_instance</span><span class="params">(cfg_path, section)</span>:</span></div><div class="line">	cfg = MySQL_Utils(cfg_path, section)</div><div class="line">	<span class="keyword">return</span> cfg</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sql_insert</span><span class="params">(table, ip)</span>:</span></div><div class="line">	<span class="keyword">if</span> table <span class="keyword">and</span> ip:</div><div class="line">		sql = <span class="string">'''INSERT INTO &#123;0&#125;(ip) VALUES ('&#123;1&#125;'); '''</span>.format(table, ip)</div><div class="line">	<span class="keyword">else</span>:</div><div class="line">		<span class="keyword">pass</span></div><div class="line">	<span class="keyword">return</span> sql</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">	time_start = time.time()</div><div class="line"></div><div class="line">	cfg = mysql_instance(CFG_PATH, SECTION)</div><div class="line"></div><div class="line">	<span class="keyword">with</span> codecs.open(<span class="string">'../data/ip_data.txt'</span>, mode=<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</div><div class="line">		<span class="keyword">for</span> line <span class="keyword">in</span> file:</div><div class="line">			id, ip = line.strip().split(<span class="string">'\t'</span>)</div><div class="line">			insert_sql = sql_insert(<span class="string">'customers_ip_info'</span>, ip)</div><div class="line">			cfg.insert(insert_sql)</div><div class="line"></div><div class="line">	time_end = time.time()</div><div class="line">	<span class="keyword">print</span> <span class="string">"The process has been completed! It takes &#123;0:.4&#125; seconds!"</span>.format(time_end - time_start)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### update_ip_address.py</span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'FuJia'</span></div><div class="line"><span class="string">""" 更新数据库内ip所对应的地址信息address.</span></div><div class="line">"""</div><div class="line"><span class="keyword">from</span> IP_Store.utils.mysql_utils <span class="keyword">import</span> MySQL_Utils</div><div class="line"><span class="keyword">import</span> codecs,os,time</div><div class="line"><span class="keyword">from</span> IP_Store.IP_Locator <span class="keyword">import</span> IPLocator</div><div class="line"></div><div class="line"></div><div class="line">CFG_PATH = os.path.dirname(os.path.abspath(__file__)) + os.path.sep + <span class="string">'mysql.config'</span></div><div class="line">SECTION = <span class="string">'platform_database'</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">mysql_instance</span><span class="params">(cfg_path, section)</span>:</span></div><div class="line">	cfg = MySQL_Utils(cfg_path, section)</div><div class="line">	<span class="keyword">return</span> cfg</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sql</span><span class="params">(table, ip, address)</span>:</span></div><div class="line">	<span class="keyword">if</span> table <span class="keyword">and</span> ip:</div><div class="line">		sql = <span class="string">'''UPDATE &#123;0&#125; SET address='&#123;1&#125;' WHERE ip='&#123;2&#125;'; '''</span>.format(table, address, ip)</div><div class="line">		<span class="keyword">print</span> sql</div><div class="line">	<span class="keyword">else</span>:</div><div class="line">		<span class="keyword">pass</span></div><div class="line">	<span class="keyword">return</span> sql</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">	TABLE = <span class="string">'customers_ip_info'</span></div><div class="line">	time_start = time.time()</div><div class="line"></div><div class="line">	cfg = mysql_instance(CFG_PATH, SECTION)</div><div class="line">	IPL = IPLocator( <span class="string">r"D:/Pycharm/Git_Project/IP_Store/data/qqwry.dat"</span> )</div><div class="line"></div><div class="line">	sql_select = <span class="string">'''SELECT ip FROM &#123;0&#125; WHERE address IS  NULL '''</span>.format(TABLE)</div><div class="line">	<span class="keyword">for</span> ip <span class="keyword">in</span> cfg.select(sql_select):</div><div class="line">		ip = ip[<span class="number">0</span>]</div><div class="line">		address = IPL.getIpAddr(IPL.str2ip(ip))</div><div class="line">		sql_update = sql(TABLE, ip, address)</div><div class="line">		cfg.update(sql_update)</div><div class="line"></div><div class="line">	time_end = time.time()</div><div class="line">	<span class="keyword">print</span> <span class="string">"The process has been completed! It takes &#123;0:.4&#125; seconds!"</span>.format(time_end - time_start)</div></pre></td></tr></table></figure>
<hr>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### IP_Locator, 代码来源网络，有很多版本，选择较为清晰的版本  </span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line"><span class="string">""" IP_Locator: query the IP location in the QQWry.dat</span></div><div class="line">"""</div><div class="line"><span class="keyword">import</span> socket,string,struct,sys</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">IPLocator</span> :</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">( self, ipdbFile )</span>:</span></div><div class="line">        self.ipdb = open( ipdbFile, <span class="string">"rb"</span> )</div><div class="line">        str = self.ipdb.read( <span class="number">8</span> )</div><div class="line">        (self.firstIndex,self.lastIndex) = struct.unpack(<span class="string">'II'</span>,str)</div><div class="line">        self.indexCount = (self.lastIndex - self.firstIndex)/<span class="number">7</span>+<span class="number">1</span></div><div class="line">        <span class="keyword">print</span> self.getVersion(),<span class="string">" 纪录总数: %d 条 "</span>%(self.indexCount)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getVersion</span><span class="params">(self)</span>:</span></div><div class="line">        s = self.getIpAddr(<span class="number">0xffffff00L</span>)</div><div class="line">        <span class="keyword">return</span> s</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getAreaAddr</span><span class="params">(self,offset=<span class="number">0</span>)</span>:</span></div><div class="line">        <span class="keyword">if</span> offset :</div><div class="line">            self.ipdb.seek( offset )</div><div class="line">        str = self.ipdb.read( <span class="number">1</span> )</div><div class="line">        (byte,) = struct.unpack(<span class="string">'B'</span>,str)</div><div class="line">        <span class="keyword">if</span> byte == <span class="number">0x01</span> <span class="keyword">or</span> byte == <span class="number">0x02</span>:</div><div class="line">            p = self.getLong3()</div><div class="line">            <span class="keyword">if</span> p:</div><div class="line">                <span class="keyword">return</span> self.getString( p )</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">return</span> <span class="string">""</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.ipdb.seek(<span class="number">-1</span>,<span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> self.getString( offset )</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getAddr</span><span class="params">(self,offset,ip=<span class="number">0</span>)</span>:</span></div><div class="line">        self.ipdb.seek( offset + <span class="number">4</span>)</div><div class="line">        countryAddr = <span class="string">""</span></div><div class="line">        areaAddr = <span class="string">""</span></div><div class="line">        str = self.ipdb.read( <span class="number">1</span> )</div><div class="line">        (byte,) = struct.unpack(<span class="string">'B'</span>,str)</div><div class="line">        <span class="keyword">if</span> byte == <span class="number">0x01</span>:</div><div class="line">            countryOffset = self.getLong3()</div><div class="line">            self.ipdb.seek( countryOffset )</div><div class="line">            str = self.ipdb.read( <span class="number">1</span> )</div><div class="line">            (b,) = struct.unpack(<span class="string">'B'</span>,str)</div><div class="line">            <span class="keyword">if</span> b == <span class="number">0x02</span>:</div><div class="line">                countryAddr = self.getString( self.getLong3() )</div><div class="line">                self.ipdb.seek( countryOffset + <span class="number">4</span> )</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                countryAddr = self.getString( countryOffset )</div><div class="line">            areaAddr = self.getAreaAddr()</div><div class="line">        <span class="keyword">elif</span> byte == <span class="number">0x02</span>:</div><div class="line">            countryAddr = self.getString( self.getLong3() )</div><div class="line">            areaAddr = self.getAreaAddr( offset + <span class="number">8</span> )</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            countryAddr = self.getString( offset + <span class="number">4</span> )</div><div class="line">            areaAddr = self.getAreaAddr()</div><div class="line">        <span class="keyword">return</span> countryAddr + <span class="string">" "</span> + areaAddr</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(self, first ,last )</span>:</span></div><div class="line">        <span class="keyword">if</span> last &gt; self.indexCount :</div><div class="line">            last = self.indexCount</div><div class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(first,last):</div><div class="line">            offset = self.firstIndex + index * <span class="number">7</span></div><div class="line">            self.ipdb.seek( offset )</div><div class="line">            buf = self.ipdb.read( <span class="number">7</span> )</div><div class="line">            (ip,of1,of2) = struct.unpack(<span class="string">"IHB"</span>,buf)</div><div class="line">            address = self.getAddr( of1 + (of2 &lt;&lt; <span class="number">16</span>) )</div><div class="line">            <span class="comment">#把GBK转为utf-8</span></div><div class="line">            address = unicode(address,<span class="string">'gbk'</span>).encode(<span class="string">"utf-8"</span>)</div><div class="line">            <span class="keyword">print</span> <span class="string">"%d\t%s\t%s"</span> %(index, self.ip2str(ip), \</div><div class="line">                address )</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setIpRange</span><span class="params">(self,index)</span>:</span></div><div class="line">        offset = self.firstIndex + index * <span class="number">7</span></div><div class="line">        self.ipdb.seek( offset )</div><div class="line">        buf = self.ipdb.read( <span class="number">7</span> )</div><div class="line">        (self.curStartIp,of1,of2) = struct.unpack(<span class="string">"IHB"</span>,buf)</div><div class="line">        self.curEndIpOffset = of1 + (of2 &lt;&lt; <span class="number">16</span>)</div><div class="line">        self.ipdb.seek( self.curEndIpOffset )</div><div class="line">        buf = self.ipdb.read( <span class="number">4</span> )</div><div class="line">        (self.curEndIp,) = struct.unpack(<span class="string">"I"</span>,buf)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getIpAddr</span><span class="params">(self,ip)</span>:</span></div><div class="line">        L = <span class="number">0</span></div><div class="line">        R = self.indexCount - <span class="number">1</span></div><div class="line">        <span class="keyword">while</span> L &lt; R<span class="number">-1</span>:</div><div class="line">            M = (L + R) / <span class="number">2</span></div><div class="line">            self.setIpRange(M)</div><div class="line">            <span class="keyword">if</span> ip == self.curStartIp:</div><div class="line">                L = M</div><div class="line">                <span class="keyword">break</span></div><div class="line">            <span class="keyword">if</span> ip &gt; self.curStartIp:</div><div class="line">                L = M</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                R = M</div><div class="line">        self.setIpRange( L )</div><div class="line">        <span class="comment">#version information,255.255.255.X,urgy but useful</span></div><div class="line">        <span class="keyword">if</span> ip&amp;<span class="number">0xffffff00L</span> == <span class="number">0xffffff00L</span>:</div><div class="line">            self.setIpRange( R )</div><div class="line">        <span class="keyword">if</span> self.curStartIp &lt;= ip &lt;= self.curEndIp:</div><div class="line">            address = self.getAddr( self.curEndIpOffset )</div><div class="line">            <span class="comment">#把GBK转为utf-8</span></div><div class="line">            address = unicode(address,<span class="string">'gbk'</span>).encode(<span class="string">"utf-8"</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            address = <span class="string">"未找到该IP的地址"</span></div><div class="line">        <span class="keyword">return</span> address</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getIpRange</span><span class="params">(self,ip)</span>:</span></div><div class="line">        self.getIpAddr(ip)</div><div class="line">        range = self.ip2str(self.curStartIp) + <span class="string">' - '</span> \</div><div class="line">            + self.ip2str(self.curEndIp)</div><div class="line">        <span class="keyword">return</span> range</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getString</span><span class="params">(self,offset = <span class="number">0</span>)</span>:</span></div><div class="line">        <span class="keyword">if</span> offset :</div><div class="line">            self.ipdb.seek( offset )</div><div class="line">        str = <span class="string">""</span></div><div class="line">        ch = self.ipdb.read( <span class="number">1</span> )</div><div class="line">        (byte,) = struct.unpack(<span class="string">'B'</span>,ch)</div><div class="line">        <span class="keyword">while</span> byte != <span class="number">0</span>:</div><div class="line">            str = str + ch</div><div class="line">            ch = self.ipdb.read( <span class="number">1</span> )</div><div class="line">            (byte,) = struct.unpack(<span class="string">'B'</span>,ch)</div><div class="line">        <span class="keyword">return</span> str</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ip2str</span><span class="params">(self,ip)</span>:</span></div><div class="line">        <span class="keyword">return</span> str(ip&gt;&gt;<span class="number">24</span>)+<span class="string">'.'</span>+str((ip&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffL</span>)+<span class="string">'.'</span> \</div><div class="line">            +str((ip&gt;&gt;<span class="number">8</span>)&amp;<span class="number">0xffL</span>)+<span class="string">'.'</span>+str(ip&amp;<span class="number">0xffL</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">str2ip</span><span class="params">(self,s)</span>:</span></div><div class="line">        (ip,) = struct.unpack(<span class="string">'I'</span>,socket.inet_aton(s))</div><div class="line">        <span class="keyword">return</span> ((ip&gt;&gt;<span class="number">24</span>)&amp;<span class="number">0xffL</span>)|((ip&amp;<span class="number">0xffL</span>)&lt;&lt;<span class="number">24</span>) \</div><div class="line">            |((ip&gt;&gt;<span class="number">8</span>)&amp;<span class="number">0xff00L</span>)|((ip&amp;<span class="number">0xff00L</span>)&lt;&lt;<span class="number">8</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLong3</span><span class="params">(self,offset = <span class="number">0</span>)</span>:</span></div><div class="line">        <span class="keyword">if</span> offset :</div><div class="line">            self.ipdb.seek( offset )</div><div class="line">        str = self.ipdb.read(<span class="number">3</span>)</div><div class="line">        (a,b) = struct.unpack(<span class="string">'HB'</span>,str)</div><div class="line">        <span class="keyword">return</span> (b &lt;&lt; <span class="number">16</span>) + a</div><div class="line"><span class="comment">#Demo</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    IPL = IPLocator( <span class="string">r"D:/Pycharm/Git_Project/IP_Store/data/qqwry.dat"</span> )</div><div class="line">    ip = <span class="string">""</span></div><div class="line">    <span class="comment"># if len(sys.argv) != 2:</span></div><div class="line">    <span class="comment">#     print 'Usage: python IPLocator.py &lt;IP&gt;'</span></div><div class="line">    <span class="comment">#     return</span></div><div class="line">    <span class="comment"># else:</span></div><div class="line">    <span class="comment">#     ip = sys.argv[1]</span></div><div class="line">    ip = <span class="string">"106.120.5.48"</span></div><div class="line">    address = IPL.getIpAddr( IPL.str2ip(ip) )</div><div class="line">    range = IPL.getIpRange( IPL.str2ip(ip) )</div><div class="line">    <span class="keyword">print</span> <span class="string">"此IP %s 属于 %s\n所在网段: %s"</span> % (ip,address, range)</div><div class="line">    <span class="keyword">print</span> address</div><div class="line">    <span class="keyword">print</span> range</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span> :</div><div class="line">    main()</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### ChinaMap_JS.py</span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'Fujia'</span></div><div class="line"><span class="string">""" http://echarts.baidu.com/demo.html#map-china-dataRange</span></div><div class="line">"""</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChinaMap</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">	CONTENT_Start = <span class="string">'''option = &#123;</span></div><div class="line">    title: &#123;</div><div class="line">        text: '平台注册用户分布',</div><div class="line">        subtext: '',</div><div class="line">        left: 'left'</div><div class="line">    &#125;,</div><div class="line">    tooltip: &#123;</div><div class="line">        trigger: 'item',</div><div class="line">        formatter: '&#123;b&#125;'</div><div class="line">    &#125;,</div><div class="line">    visualMap: &#123;</div><div class="line">        seriesIndex: 0,</div><div class="line">        min: 0,</div><div class="line">        max: 15000,</div><div class="line">        left: 'left',</div><div class="line">        top: 'bottom',</div><div class="line">        text: ['高','低'],           // 文本，默认为数值文本</div><div class="line">        calculable: true</div><div class="line">    &#125;,</div><div class="line">    grid: &#123;</div><div class="line">        height: 200,</div><div class="line">        width: 8,</div><div class="line">        right: 80,</div><div class="line">        bottom: 10</div><div class="line">    &#125;,</div><div class="line">    xAxis: &#123;</div><div class="line">        type: 'category',</div><div class="line">        data: [],</div><div class="line">        splitNumber: 1,</div><div class="line">        show: true</div><div class="line">    &#125;,</div><div class="line">    yAxis: &#123;</div><div class="line">        position: 'right',</div><div class="line">        min: 0,</div><div class="line">        max: 20,</div><div class="line">        splitNumber: 20,</div><div class="line">        inverse: true,</div><div class="line">        axisLabel: &#123;</div><div class="line">            show: true</div><div class="line">        &#125;,</div><div class="line">        axisLine: &#123;</div><div class="line">            show: true</div><div class="line">        &#125;,</div><div class="line">        splitLine: &#123;</div><div class="line">            show: false</div><div class="line">        &#125;,</div><div class="line">        axisTick: &#123;</div><div class="line">            show: true</div><div class="line">        &#125;,</div><div class="line">        data: []</div><div class="line">    &#125;,</div><div class="line">    series: [</div><div class="line">        &#123;</div><div class="line">            zlevel: 1,</div><div class="line">            name: '中国',</div><div class="line">            type: 'map',</div><div class="line">            mapType: 'china',</div><div class="line">            selectedMode : 'multiple',</div><div class="line">            roam: true,</div><div class="line">            left: 0,</div><div class="line">            right: '15%',</div><div class="line">            label: &#123;</div><div class="line">                normal: &#123;</div><div class="line">                    show: true</div><div class="line">                &#125;,</div><div class="line">                emphasis: &#123;</div><div class="line">                    show: true</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            data:[ '''</div><div class="line"></div><div class="line">	CONTENT_End = <span class="string">''']</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            zlevel: 2,</div><div class="line">            name: '地图指示',</div><div class="line">            type: 'bar',</div><div class="line">            barWidth: 5,</div><div class="line">            itemStyle: &#123;</div><div class="line">                normal: &#123;</div><div class="line">                    color: undefined,</div><div class="line">                    shadowColor: 'rgba(0, 0, 0, 0.1)',</div><div class="line">                    shadowBlur: 10</div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            data: [20]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"> * 根据值获取线性渐变颜色</div><div class="line"> * @param  &#123;String&#125; start 起始颜色</div><div class="line"> * @param  &#123;String&#125; end   结束颜色</div><div class="line"> * @param  &#123;Number&#125; max   最多分成多少分</div><div class="line"> * @param  &#123;Number&#125; val   渐变取值</div><div class="line"> * @return &#123;String&#125;       颜色</div><div class="line"> */</div><div class="line">function getGradientColor (start, end, max, val) &#123;</div><div class="line">    var rgb = /#((?:[0-9]|[a-fA-F])&#123;2&#125;)((?:[0-9]|[a-fA-F])&#123;2&#125;)((?:[0-9]|[a-fA-F])&#123;2&#125;)/;</div><div class="line">    var sM = start.match(rgb);</div><div class="line">    var eM = end.match(rgb);</div><div class="line">    var err = '';</div><div class="line">    max = max || 1</div><div class="line">    val = val || 0</div><div class="line">    if (sM === null) &#123;</div><div class="line">        err = 'start';</div><div class="line">    &#125;</div><div class="line">    if (eM === null) &#123;</div><div class="line">        err = 'end';</div><div class="line">    &#125;</div><div class="line">    if (err.length &gt; 0) &#123;</div><div class="line">        throw new Error('Invalid ' + err + ' color format, required hex color');</div><div class="line">    &#125;</div><div class="line">    var sR = parseInt(sM[1], 16),</div><div class="line">        sG = parseInt(sM[2], 16),</div><div class="line">        sB = parseInt(sM[3], 16);</div><div class="line">    var eR = parseInt(eM[1], 16),</div><div class="line">        eG = parseInt(eM[2], 16),</div><div class="line">        eB = parseInt(eM[3], 16);</div><div class="line">    var p = val / max;</div><div class="line">    var gR = Math.round(sR + (eR - sR) * p).toString(16),</div><div class="line">        gG = Math.round(sG + (eG - sG) * p).toString(16),</div><div class="line">        gB = Math.round(sB + (eB - sB) * p).toString(16);</div><div class="line">    return '#' + gR + gG + gB;</div><div class="line">&#125;</div><div class="line"></div><div class="line">setTimeout(function() &#123;</div><div class="line">    var TOPN = 25</div><div class="line"></div><div class="line">    var option = myChart.getOption()</div><div class="line">    // 修改top</div><div class="line">    option.grid[0].height = TOPN * 20</div><div class="line">    option.yAxis[0].max = TOPN</div><div class="line">    option.yAxis[0].splitNumber = TOPN</div><div class="line">    option.series[1].data[0] = TOPN</div><div class="line">    // 排序</div><div class="line">    var data = option.series[0].data.sort(function(a, b) &#123;</div><div class="line">        return b.value - a.value</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    var maxValue = data[0].value,</div><div class="line">        minValue = data.length &gt; TOPN ? data[TOPN - 1].value : data[data.length - 1].value</div><div class="line"></div><div class="line">    var s = option.visualMap[0].controller.inRange.color[0],</div><div class="line">        e = option.visualMap[0].controller.inRange.color.slice(-1)[0]</div><div class="line">    var sColor = getGradientColor(s, e, maxValue, minValue)</div><div class="line">    var eColor = getGradientColor(s, e, maxValue, maxValue)</div><div class="line"></div><div class="line">    option.series[1].itemStyle.normal.color = new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;</div><div class="line">        offset: 1,</div><div class="line">        color: sColor</div><div class="line">    &#125;, &#123;</div><div class="line">        offset: 0,</div><div class="line">        color: eColor</div><div class="line">    &#125;])</div><div class="line"></div><div class="line">    // yAxis</div><div class="line">    var newYAxisArr = []</div><div class="line">    echarts.util.each(data, function(item, i) &#123;</div><div class="line">        if (i &gt;= TOPN) &#123;</div><div class="line">            return false</div><div class="line">        &#125;</div><div class="line">        var c = getGradientColor(sColor, eColor, maxValue, item.value)</div><div class="line">        newYAxisArr.push(&#123;</div><div class="line">            value: item.name,</div><div class="line">            textStyle: &#123;</div><div class="line">                color: c</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">    option.yAxis[0].data = newYAxisArr</div><div class="line">    option.yAxis[0].axisLabel.formatter = (function(data) &#123;</div><div class="line">        return function(value, i) &#123;</div><div class="line">            if (!value) return ''</div><div class="line">            return value + ' ' + data[i].value</div><div class="line">        &#125;</div><div class="line">    &#125;)(data)</div><div class="line">    myChart.setOption(option)</div><div class="line">&#125;, 0);</div><div class="line"></div><div class="line">'''</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">	JS_Scripts = ChinaMap()</div><div class="line">	summary_string = <span class="string">'''</span></div><div class="line">		&#123;name:'安徽',value:2712&#125;,</div><div class="line">		&#123;name:'澳门',value:21&#125;,</div><div class="line">		&#123;name:'北京',value:5351&#125;,</div><div class="line">		&#123;name:'福建',value:3494&#125;,</div><div class="line">		&#123;name:'甘肃',value:697&#125;,</div><div class="line">		&#123;name:'广东',value:13418&#125;,</div><div class="line">		&#123;name:'广西',value:2072&#125;,</div><div class="line">		&#123;name:'贵州',value:1067&#125;,</div><div class="line">		&#123;name:'海南',value:376&#125;,</div><div class="line">		&#123;name:'河北',value:3318&#125;,</div><div class="line">		&#123;name:'河南',value:5552&#125;,</div><div class="line">		&#123;name:'黑龙江',value:1117&#125;,</div><div class="line">		&#123;name:'湖北',value:3286&#125;,</div><div class="line">		&#123;name:'湖南',value:2885&#125;,</div><div class="line">		&#123;name:'吉林',value:873&#125;,</div><div class="line">		&#123;name:'江苏',value:5330&#125;,</div><div class="line">		&#123;name:'江西',value:2255&#125;,</div><div class="line">		&#123;name:'辽宁',value:1718&#125;,</div><div class="line">		&#123;name:'内蒙古',value:739&#125;,</div><div class="line">		&#123;name:'宁夏',value:217&#125;,</div><div class="line">		&#123;name:'青海',value:105&#125;,</div><div class="line">		&#123;name:'山东',value:5476&#125;,</div><div class="line">		&#123;name:'山西',value:1756&#125;,</div><div class="line">		&#123;name:'陕西',value:2033&#125;,</div><div class="line">		&#123;name:'上海',value:3173&#125;,</div><div class="line">		&#123;name:'四川',value:4121&#125;,</div><div class="line">		&#123;name:'台湾',value:94&#125;,</div><div class="line">		&#123;name:'天津',value:945&#125;,</div><div class="line">		&#123;name:'西藏',value:43&#125;,</div><div class="line">		&#123;name:'香港',value:122&#125;,</div><div class="line">		&#123;name:'新疆',value:575&#125;,</div><div class="line">		&#123;name:'云南',value:1045&#125;,</div><div class="line">		&#123;name:'浙江',value:5311&#125;,</div><div class="line">		&#123;name:'重庆',value:1744&#125;</div><div class="line">	'''</div><div class="line">	JS_CODE = JS_Scripts.CONTENT_Start + summary_string.encode(<span class="string">'utf-8'</span>) + JS_Scripts.CONTENT_End</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### china_map_summary.py</span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'Fujia'</span></div><div class="line"></div><div class="line"><span class="string">""" 统计IP地址信息,绘制China Map分布图.</span></div><div class="line">link : http://echarts.baidu.com/demo.html#map-china-dataRange</div><div class="line">"""</div><div class="line"></div><div class="line"><span class="keyword">import</span> time,os</div><div class="line"><span class="keyword">from</span> IP_Store.utils.mysql_utils <span class="keyword">import</span> MySQL_Utils</div><div class="line"><span class="keyword">from</span> IP_Store.ChinaMap_JS <span class="keyword">import</span> ChinaMap</div><div class="line"></div><div class="line">CFG_PATH = os.path.dirname(os.path.abspath(__file__)) + os.path.sep + <span class="string">'utils/mysql.config'</span></div><div class="line">SECTION = <span class="string">'platform_database'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">mysql_instance</span><span class="params">(cfg_path, section)</span>:</span></div><div class="line">	cfg = MySQL_Utils(cfg_path, section)</div><div class="line">	<span class="keyword">return</span> cfg</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">data</span><span class="params">()</span>:</span></div><div class="line">	cfg = mysql_instance(CFG_PATH, SECTION)</div><div class="line">	sql_select = <span class="string">'''SELECT left(address,2),count(*)</span></div><div class="line">					FROM &#123;0&#125;</div><div class="line">					WHERE address IS NOT NULL</div><div class="line">					AND LEFT(address,2) REGEXP '(北京)|(天津)|(上海)|(重庆)|(河北)|(河南)|(云南)|(辽宁)|(黑龙)|(湖南)|(安徽)|(山东)|(新疆)|(江苏)|(浙江)|(江西)|(湖北)|(广西)|(甘肃)|(山西)|(内蒙)|(陕西)|(吉林)|(福建)|(贵州)|(广东)|(青海)|(西藏)|(四川)|(宁夏)|(海南)|(台湾)|(香港)|(澳门)'</div><div class="line">					GROUP BY LEFT(address,2) '''.format(TABLE)</div><div class="line">	<span class="keyword">return</span> cfg.select(sql_select)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">	TABLE = <span class="string">'customers_ip_info'</span></div><div class="line">	time_start = time.time()</div><div class="line"></div><div class="line">	summary_string = <span class="string">'\n'</span></div><div class="line"></div><div class="line">	<span class="keyword">for</span> line <span class="keyword">in</span> data():</div><div class="line">		province, count = line</div><div class="line">		<span class="keyword">if</span> province == <span class="string">u'黑龙'</span>:</div><div class="line">			summary_string += <span class="string">"&#123;name:'"</span> + <span class="string">u"黑龙江"</span> +<span class="string">"',value:"</span> + str(count) + <span class="string">"&#125;,\n"</span></div><div class="line">		<span class="keyword">elif</span> province == <span class="string">u'内蒙'</span>:</div><div class="line">			summary_string += <span class="string">"&#123;name:'"</span> + <span class="string">u"内蒙古"</span> +<span class="string">"',value:"</span> + str(count) + <span class="string">"&#125;,\n"</span></div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			summary_string += <span class="string">"&#123;name:'"</span> + province +<span class="string">"',value:"</span> + str(count) + <span class="string">"&#125;,\n"</span></div><div class="line"></div><div class="line">	JS_Scripts = ChinaMap()</div><div class="line">	JS_CODE = JS_Scripts.CONTENT_Start + summary_string.encode(<span class="string">'utf-8'</span>) + JS_Scripts.CONTENT_End</div><div class="line"></div><div class="line">	<span class="keyword">print</span> JS_CODE</div></pre></td></tr></table></figure>
<hr>
<h4 id="数据可视化"><a href="#数据可视化" class="headerlink" title="数据可视化"></a>数据可视化</h4><p>将“JS_CODE”结果直接粘贴到<a href="http://echarts.baidu.com/demo.html#map-china-dataRange" target="_blank" rel="external">Echart ChinaMap</a>中生成可视化图像即可。 可视化效果如</p>
<p><img src="http://on58f12qv.bkt.clouddn.com/%E5%9C%B0%E5%9B%BE%E5%88%86%E5%B8%83%E5%8F%AF%E8%A7%86%E5%8C%96.png" alt="注册地图可视化"></p>
<h3 id="to-do"><a href="#To-Do" class="headerlink" title="To-Do"></a>To-Do</h3><ul>
<li><ol>
<li>代码重构，减少冗余</li>
</ol>
</li>
<li><ol>
<li>数据库连接池，提高读写数据库效率</li>
</ol>
</li>
<li><ol>
<li>地图可视化自动化，或嵌入网页微框架</li>
</ol>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/04/27/《Python算法教程》读书笔记-（四）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/27/《Python算法教程》读书笔记-（四）/" itemprop="url">
                  《Python算法教程》读书笔记 - （四）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-27T22:26:51+08:00">
                2017-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="树的概念"><a href="#树的概念" class="headerlink" title="树的概念"></a>树的概念</h3><p>树，本身就是图的一种特殊情况。树在算法中扮演着及其重要的角色，并且有许多特定问题是推荐用树结构来解决。大部分树算法都可以被理解成一般图概念中的思路，但特定的树结构会使得它们更容易实现。</p>
<p>最容易表示的就是带根的树结构，这种树的每条边都从根出发，并向下延伸。此类结构所代表的往往是某个数据集所拥有的层次结构，其根节点代表着全部对象，而其内部各节点所代表的对象都是以该节点为根的树结构的叶节点。</p>
<p>示例如下图：</p>
<p>可以将该树表示成一个二维列表(lists of lists)，代码如下所示：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>T = [[<span class="string">'a'</span>, <span class="string">'b'</span>], [<span class="string">'c'</span>], [<span class="string">'d'</span>, [<span class="string">'e'</span>, <span class="string">'f'</span>]]]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">0</span>][<span class="number">1</span>]</div><div class="line">&gt; b</div><div class="line"></div><div class="line"><span class="comment"># 访问的一次是根节点的第三个子节点,然后是该子节点的第二个子节点,最后是这个子节点的第一个子节点，即页节点</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">2</span>][<span class="number">1</span>][<span class="number">0</span>]</div><div class="line">&gt; <span class="string">'e'</span></div></pre></td></tr></table></figure></p>
<p>这种方法中，每个列表表示的都是相应内部（匿名）节点所拥有的一个包含其所有相邻节点的列表。</p>
<hr>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>有时实现知道其内部所能拥有的最大子节点数(如二叉树，各节点最多只能拥有两个子节点)，所以可以选择其他表示法，如为各对象的各子节点设置相应的属性。还可以用None值来表示不存在的子节点。如下代码所示：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 二叉树类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tree</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,left,right)</span>:</span></div><div class="line">		self.left = left</div><div class="line">		self.right = right</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t = Tree(Tree(<span class="string">"a"</span>,<span class="string">"b"</span>),Tree(<span class="string">"c"</span>,<span class="string">"d"</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t.right.left</div><div class="line">&gt; <span class="string">"c"</span></div></pre></td></tr></table></figure></p>
<p>对于没有内置list类型的语言，还有一种常见的树实现方式，即采取“先子节点，后兄弟节点”的表示方法。在这种表示法里，每一个树节点都有两个用于引用其他节点的“指针”或属性，这似乎与二叉树的情况很类似。然而在这里，<strong>!第一个引用指向的是当前节点的第一个子节点!</strong>，而<strong>!第二个引用所指向的则是下一个兄弟节点!</strong>。换句话说，这里的各个节点所对应用的是一个其子节点的兄弟节点链表，并且这些兄弟节点又各自引用了属于他们自己的那个兄弟节点链表。如下代码所示：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 多路搜索树类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tree</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,kids,next=None)</span>:</span></div><div class="line">		self.kids = self.val = kids</div><div class="line">		self.next = next</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t = Tree(Tree(<span class="string">"d"</span>,Tree(<span class="string">"b"</span>,Tree(<span class="string">"c"</span>,Tree(<span class="string">"d"</span>)))))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t.kids.next.next.val</div><div class="line">&gt; <span class="string">"c"</span></div></pre></td></tr></table></figure></p>
<p><strong>小插曲：Bunch模式</strong></p>
<blockquote>
<p>“Bunch设计模式”，基本上其实现方式中都会具备以下要素：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bunch</span><span class="params">(dict)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,*args,**kwds)</span>:</span></div><div class="line">		super(Bunch, self).__init__(*args,**kwds)</div><div class="line">		self.__dict__ = self</div></pre></td></tr></table></figure></p>
</blockquote>
<p>该模式主要有几个有用的方面.首先，它能让我们以命令行参数的形式创建相关对象，并设置任何属性：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>x = Bunch(name=<span class="string">"Jayne Cobb"</span>,position=<span class="string">"Public Relations"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>x.name</div><div class="line">&gt; <span class="string">"Jayne Cobb"</span></div><div class="line"><span class="comment"># x的结果</span></div><div class="line">&#123;<span class="string">'name'</span>: <span class="string">'Jayne Cobb'</span>, <span class="string">'position'</span>: <span class="string">'Public Relations'</span>&#125;</div></pre></td></tr></table></figure></p>
<p>其次，由于它继承自dict类，可以自然而然地获得大量相关的操作。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>T = Bunch</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t = T(left=T(left=<span class="string">"a"</span>,right=<span class="string">"b"</span>),right=T(left=<span class="string">"c"</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t.left.right</div><div class="line">&gt; <span class="string">"b"</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="string">'left'</span>][<span class="string">'right'</span>]</div><div class="line">&gt; <span class="string">"b"</span></div></pre></td></tr></table></figure></p>
<p>注：Bunch设计模式直观的感受是递归调用，但是没有理解，后续在回过头来学习这块内容~</p>
<hr>
<h3 id="树的多种表示法"><a href="#树的多种表示法" class="headerlink" title="树的多种表示法"></a>树的多种表示法</h3><p>常用的表示方法：邻接列表、邻接数组、邻接矩阵。</p>
<p>在邻接矩阵中，查询边(u,v)需要的时间为$\theta(1)$，遍历v邻居的操作时间为$\theta(n)$，而到了邻接列表这种表示法中，两种操作所需要的时间都为$\theta(d(v))$。</p>
<p>解析XML文档或者遍历某文件系统目录结构时，直接使用现成的树结构和API。</p>
<p>最后介绍的一类图结构叫做<strong>子问题图(subproblem graph)</strong>，将来在学习各种不同算法技术时还会多次涉及它。</p>
<p>这个概念简单地说就是，绝大部分问题应该都可以被分成若干个子问题，这些子问题在结构上往往都非常相似。因此，这些结构可以被看做相关子问题图中的节点，而它们间的依赖关系就称为该图的边。例如，分治法以及动态规划等技术就出自这些分析。</p>
<hr>
<h3 id="算法编程中提防的陷阱"><a href="#算法编程中提防的陷阱" class="headerlink" title="算法编程中提防的陷阱"></a>算法编程中提防的陷阱</h3><ol>
<li>当性能成为重点问题时，要着重于实际分析而不是直觉。</li>
<li>当正确性至关重要时，最好的做法是用不同的实现体来对答案进行多次计算，即冗余原则。</li>
</ol>
<h4 id="隐性平方级操作"><a href="#隐性平方级操作" class="headerlink" title="隐性平方级操作"></a>隐性平方级操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> random <span class="keyword">import</span> randrange</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>L = [randrange(<span class="number">10000</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>)]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">42</span> <span class="keyword">in</span> L</div><div class="line">&gt; <span class="keyword">False</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>S =set(L)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">42</span> <span class="keyword">in</span> S</div><div class="line">&gt; <span class="keyword">False</span></div></pre></td></tr></table></figure>
<p>这个示例很能说明问题。正如书中所说，两种方式都很快，似乎在list上构建一个set是毫无意义的。实际代码的构造是依据具体情况的。如果进行多次成员查询操作，这样做值得！因为成员检测在list中是线性级的，而在set中则是常数级的。如果想依次往集合里添加新值，并在每一步中都检查该值是否已经被添加的话，这种情况用list来处理的话，运行时间是平方级的，而用set就可以获得线性级时间。 </p>
<p>但也有一些不那么明显的例子，它们也会带来许多问题。如下代码所示：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">S = <span class="string">''</span></div><div class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> string_producer():</div><div class="line">	s += chunk</div></pre></td></tr></table></figure></p>
<p>Python自身采用了一些非常聪明的优化，它在扩展到某一规模之前都能工作的很好 — 但随后这些优化的作用就会消退，运行时间也因此猛然呈现出平方级的增长。问题在于，需要在每次执行+=操作时新建一个字符串，并复制上一个字符串内容。这是一个有风险的业务逻辑。它有一个更好的解决方案：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">chunks = []</div><div class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> string_producer():</div><div class="line">	chunks.append(chunk)</div><div class="line">s = <span class="string">''</span>.join(chunks)</div><div class="line"><span class="comment"># 更优化</span></div><div class="line">s = <span class="string">''</span>.join(string_producer())</div></pre></td></tr></table></figure></p>
<h4 id="浮点数运算的麻烦"><a href="#浮点数运算的麻烦" class="headerlink" title="浮点数运算的麻烦"></a>浮点数运算的麻烦</h4><p>第一课就是“不要对浮点数进行等值比较”。实际应用中，我们可以检查它们是否接近于相等。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 2.7.10</span></div><div class="line">&gt;&gt;&gt;sum(<span class="number">0.1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)) == <span class="number">1.0</span></div><div class="line">&gt;<span class="keyword">False</span></div><div class="line"></div><div class="line"><span class="comment"># 改进实现</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">almost_equal</span><span class="params">(x, y, places=<span class="number">7</span>)</span>:</span></div><div class="line">	<span class="keyword">return</span> round(abs(x-y),places) == <span class="number">0</span></div><div class="line">&gt;&gt;&gt;almost_equal(sum(<span class="number">0.1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)),<span class="number">1.0</span>)</div><div class="line">&gt;<span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<p>此外，如果需要某种精确的十进制浮点数表示法，可以选择使用其他工具，如<code>decimal</code>模块：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</div><div class="line">sum(Decimal(<span class="string">"0.1"</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)) == Decimal(<span class="string">"1.0"</span>)</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/04/26/《Python算法教程》读书笔记-（三）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/26/《Python算法教程》读书笔记-（三）/" itemprop="url">
                  《Python算法教程》读书笔记 - （三）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-26T22:18:00+08:00">
                2017-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这篇博客重点是<strong>图与树</strong>的实现。</p>
<hr>
<h3 id="图与树"><a href="#图与树" class="headerlink" title="图与树"></a>图与树</h3><p>算法中最强大的框架之一 — 图结构(graph)，通常，如果可以讲问题诠释成一个图问题的话，至少该问题已经接近解决方案了；如果可以用树结构(tree)来诠释的话，基本已经拥有了一个真正的解决方案！足以说明树结构和图结构的重要性！</p>
<p>图结构可以表现几乎所有类型的结构与系统，例如交通网络、通信网络、细胞核交互、社交关系等等，并可通过添加权重值、距离值等额外数据来增强其表现能力。而树结构只是图结构的一种特殊情况。有很多的机构形式，如XML文档或者目录层次结构等等，实际上也都是用树结构来表现的。</p>
<p>以下是一些图术语：</p>
<blockquote>
<ol>
<li>图$G=(V,E)$通常由一组节点$V$及节点间的边$E$共同组成。如果这些边是带有方向的，则称其为有向图；</li>
<li>节点之间是通过边来实现彼此相连的。这些边其实就是节点$v$与其邻居之间的关系。与节点$v$相邻的节点，称为节点$v$的邻居。<strong>一个节点的度数就是连接其边的个数。</strong></li>
<li>图$G=(V,E)$的子图结构将由$V$的子集与$E$的子集共同组成。在$G$中没一条路径(path)是一个子图结构，本质上都是一些由多个节点串联而成的边线序列。环路(cycle)的定义与路径基本相同，只不过它最后一条边所连接末节点同时是它的首节点。</li>
<li>如果将图$G$中的每条边与某种权值联系在一起，就成为一种加权图。在加权图中，一条路径或环路的长度等于各条边上的权值之和；而对于非加权图而言，就直接等于该图的边数了。</li>
<li>森林(forest)可以被认为是一个无环路图，而这样的连通图就是一棵树。实质上，森林就是由一棵或多棵树构成的。</li>
</ol>
</blockquote>
<hr>
<h3 id="图数据结构"><a href="#图数据结构" class="headerlink" title="图数据结构"></a>图数据结构</h3><p>上面目前介绍关于图的一些基本概念，接下来核心知识即学会用某种数据结构来表示图。</p>
<p>用抽象属于来说，倾向于采用一种被称为邻近函数$N(v)$(neighborhood function)的实现方式。在这，会涉及一个容器N[v]，主要用于存储v节点的邻近节点。常见图数据结构主要放在<strong>邻接列表和邻接矩阵</strong>这两种著名的表现形式上，它们的可用性和普及率都很高。</p>
<p><strong>小插曲：黑盒子专栏之 dict 和 set</strong></p>
<blockquote>
<p>散列(hashing)在算法中及其常见，在Python语言中，标准散列机制是由hash函数提供的，如下调用一个对象的<code>__hash__</code>方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; hash(<span class="number">42</span>)</div><div class="line"><span class="number">42</span></div><div class="line">&gt; hash(<span class="string">"Hello,World!"</span>)</div><div class="line"><span class="number">1564194085</span></div></pre></td></tr></table></figure></p>
<p>该机制常用于字典类型(dict)的实现，dict就是通常所说的散列表。同样，集合类型(set)也是通过这种机制实现的。记住最重要的一点，<strong>散列值的构成基本上是在常数级时间内完成的</strong>。这意味着在对dict和set中的元素进行访问时所消耗的时间都是常数级别的，对于构建更为复杂的结构与算法是非常有用的！</p>
</blockquote>
<p>后续详细的学习下hash方法和<code>hashlib</code>模块。</p>
<hr>
<h3 id="邻接列表与其类似结构"><a href="#邻接列表与其类似结构" class="headerlink" title="邻接列表与其类似结构"></a>邻接列表与其类似结构</h3><p>对于图结构而言，最直观的实现方式之一就是使用邻接列表。即要针对每个结点设置一个邻居列表（也可以使set等其他容器或迭代器类型）。</p>
<p>接下来实现一个最简单的：假设有n个结点，编号分别为$0,1,…,n-1$，然后每个邻接(邻居)列表就都指示一个数字列表，可以讲它们编入一个大小为n的主列表，并用节点编号对其进行索引。由于这些列表内的顺序是任意的，所以实际上我们是使用集合来实现邻接集(adjacency sets)。</p>
<p>以下图为例具体说明图结构的各种表示法：</p>
<p>首先，完成对节点的编号工作$(a=0,b=1,c=2,d=3,e=4,f=5,g=6,h=7)$。该图可以先用一种简单明了的方式来表示，如下所示：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 简单明了的邻接集表示法</span></div><div class="line">a, b, c, d, e, f, g, h = range(<span class="number">8</span>)</div><div class="line">N = [</div><div class="line">	&#123;b, c, d, e, f&#125;,  <span class="comment"># a</span></div><div class="line">	&#123;c, e&#125;,           <span class="comment"># b</span></div><div class="line">	&#123;d&#125;,              <span class="comment"># c</span></div><div class="line">	&#123;e&#125;,              <span class="comment"># d</span></div><div class="line">	&#123;f&#125;,              <span class="comment"># e</span></div><div class="line">	&#123;c, g, h&#125;,        <span class="comment"># f</span></div><div class="line">	&#123;f, h&#125;,           <span class="comment"># g</span></div><div class="line">	&#123;f, g&#125;            <span class="comment"># h</span></div><div class="line">]</div><div class="line"><span class="comment">## 结果,在Ipython中结果如下，在Python解释器中是类似set([1,2,3,4,5])。</span></div><div class="line">&gt; [&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;, &#123;<span class="number">2</span>, <span class="number">4</span>&#125;, &#123;<span class="number">3</span>&#125;, &#123;<span class="number">4</span>&#125;, &#123;<span class="number">5</span>&#125;, &#123;<span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>&#125;, &#123;<span class="number">5</span>, <span class="number">7</span>&#125;, &#123;<span class="number">5</span>, <span class="number">6</span>&#125;]</div></pre></td></tr></table></figure></p>
<p>变量N作用相当于之前提到的N函数。在图论中，$N(v)$代表的是v节点的邻居节点集。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; N[a]    <span class="comment"># a节点的邻居节点集</span></div><div class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</div><div class="line">&gt; b <span class="keyword">in</span> N[a]   <span class="comment"># 判断b节点是否是a节点的邻居节点</span></div><div class="line"><span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<p>在某些情况下，另一种表示方法的开销会更小一些，即用真正的邻接列表来代替上面的邻接集。如下所示：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 简单明了的邻接列表示法</span></div><div class="line">a, b, c, d, e, f, g, h = range(<span class="number">8</span>)</div><div class="line">N = [</div><div class="line">	[b, c, d, e, f],  <span class="comment"># a</span></div><div class="line">	[c, e],           <span class="comment"># b</span></div><div class="line">	[d],              <span class="comment"># c</span></div><div class="line">	[e],              <span class="comment"># d</span></div><div class="line">	[f],              <span class="comment"># e</span></div><div class="line">	[c, g, h],        <span class="comment"># f</span></div><div class="line">	[f, h],           <span class="comment"># g</span></div><div class="line">	[f, g]            <span class="comment"># h</span></div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>这种表示法可能存在着一个争议，因为它实际上是一组邻接数组的结合，而并非传统意义上的邻接列表。</p>
<p>在Python中，list类型的背后实际上是一个<strong>动态数组</strong>。</p>
<p>在执行与图有关的工作时，要遵从一个主题思想，即一个图的最佳表示方法应该取决于我们用它来做什么！例如，邻接列表(或数组)可以让我们在维持低成本的情况下，对$N(v)$中所有节点v进行有效遍历。然而，在检查u和v是否互为邻居时的成本就是$\theta(N(v))$。这时如果改图的结构很密集(如果它的边很多的话)，很可能会带来一些问题，此时邻接集或许是个更好的选择。</p>
<p>还有另外一种表示方法，就是用dict类型来替代这里的set或list。在dict类型中，每个邻居几点都会有一个键值对，用于表示与其邻居节点（或<strong>出边</strong>）之间的关联性，如边的权重。如下所示：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 加权邻接字典</span></div><div class="line">a, b, c, d, e, f, g, h = range(<span class="number">8</span>)</div><div class="line">N = [</div><div class="line">	&#123;b:<span class="number">2</span>, c:<span class="number">1</span>, d:<span class="number">3</span>, e:<span class="number">9</span>, f:<span class="number">4</span>&#125;,  <span class="comment"># a</span></div><div class="line">	&#123;c:<span class="number">4</span>, e:<span class="number">4</span>&#125;,           <span class="comment"># b</span></div><div class="line">	&#123;d:<span class="number">8</span>&#125;,              <span class="comment"># c</span></div><div class="line">	&#123;e:<span class="number">7</span>&#125;,              <span class="comment"># d</span></div><div class="line">	&#123;f:<span class="number">5</span>&#125;,              <span class="comment"># e</span></div><div class="line">	&#123;c:<span class="number">2</span>, g:<span class="number">2</span>, h:<span class="number">2</span>&#125;,        <span class="comment"># f</span></div><div class="line">	&#123;f:<span class="number">1</span>, h:<span class="number">6</span>&#125;,           <span class="comment"># g</span></div><div class="line">	&#123;f:<span class="number">9</span>, g:<span class="number">8</span>&#125;            <span class="comment"># h</span></div><div class="line">]</div><div class="line">&gt;&gt;&gt;b <span class="keyword">in</span> N[a]    <span class="comment"># Neighborhood membership  邻节点成员关系</span></div><div class="line">&gt;<span class="keyword">True</span></div><div class="line">&gt;&gt;&gt;len(N[f])    <span class="comment"># Degree   节点的度</span></div><div class="line">&gt;<span class="number">3</span></div><div class="line">&gt;&gt;&gt;N[a][b]      <span class="comment"># Edge weight for (a,b) 节点a到节点b的权重</span></div><div class="line">&gt;<span class="number">2</span></div></pre></td></tr></table></figure></p>
<p>目前为止，用来存储邻接结构（可能是list、set、dict）的主要容器其实都是列表类型，它们都以节点编号为索引值。对灵活性而言，使用dict类型来作为主要存储结构会是一种更好的选择（因为它允许我们使用任意可散列的对象来充当节点标签）。用dict存储邻接集的具体示例如下所示，在这里是用字符来表示相关节点的。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 邻接集的字典表示法</span></div><div class="line">N = &#123;</div><div class="line">	<span class="string">'a'</span>:set(<span class="string">'bcdef'</span>),        <span class="comment"># a</span></div><div class="line">	<span class="string">'b'</span>:set(<span class="string">'ce'</span>),           <span class="comment"># b</span></div><div class="line">	<span class="string">'c'</span>:set(<span class="string">'d'</span>),            <span class="comment"># c</span></div><div class="line">	<span class="string">'d'</span>:set(<span class="string">'e'</span>),            <span class="comment"># d</span></div><div class="line">	<span class="string">'e'</span>:set(<span class="string">'f'</span>),            <span class="comment"># e</span></div><div class="line">	<span class="string">'f'</span>:set(<span class="string">'cgh'</span>),          <span class="comment"># f</span></div><div class="line">	<span class="string">'g'</span>:set(<span class="string">'fh'</span>),           <span class="comment"># g</span></div><div class="line">	<span class="string">'h'</span>:set(<span class="string">'fg'</span>)            <span class="comment"># h</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="邻接矩阵"><a href="#邻接矩阵" class="headerlink" title="邻接矩阵"></a>邻接矩阵</h3><p>图的另一种常见表示法就是邻接矩阵了！这种表示的主要不同之处在于，它不再列出每个节点的所有邻居节点，而是会将每个节点可能的邻居位置排成一排（也就是一个数组，用于对应图中每个节点），然后用某种值（True或False）来表示相关节点是否为当前节点的邻居。</p>
<p>其最简单的形式也可以用嵌套list来实现，如下所示，其中，节点编号依然是从0到$V-1$，并且为了让矩阵具有更好的可读性，会用1和0来填充真值。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 用嵌套list实现的邻接矩阵</span></div><div class="line">a, b, c, d, e, f, g, h = range(<span class="number">8</span>)</div><div class="line"></div><div class="line">N = [</div><div class="line">	[<span class="number">0</span>，<span class="number">1</span>，<span class="number">1</span>，<span class="number">1</span>，<span class="number">1</span>，<span class="number">1</span>，<span class="number">0</span>，<span class="number">0</span>],    <span class="comment"># a</span></div><div class="line">	[<span class="number">0</span>，<span class="number">0</span>，<span class="number">1</span>，<span class="number">0</span>，<span class="number">1</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>],    <span class="comment"># b</span></div><div class="line">	[<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">1</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>],    <span class="comment"># c</span></div><div class="line">	[<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">1</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>],    <span class="comment"># d</span></div><div class="line">	[<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">1</span>，<span class="number">0</span>，<span class="number">0</span>],    <span class="comment"># e</span></div><div class="line">	[<span class="number">0</span>，<span class="number">0</span>，<span class="number">1</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">1</span>，<span class="number">1</span>],    <span class="comment"># f</span></div><div class="line">	[<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">1</span>，<span class="number">0</span>，<span class="number">1</span>],    <span class="comment"># g</span></div><div class="line">	[<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">0</span>，<span class="number">1</span>，<span class="number">1</span>，<span class="number">0</span>],    <span class="comment"># h</span></div><div class="line">]</div><div class="line">&gt;&gt;&gt;N[a][b]    <span class="comment"># Neighborhood membership</span></div><div class="line">&gt;<span class="number">1</span></div><div class="line">&gt;&gt;&gt;sum(N[f])    <span class="comment"># Degree</span></div><div class="line">&gt;<span class="number">3</span></div></pre></td></tr></table></figure></p>
<p>在使用方式上与邻接列表或邻接集略有不同。邻居关系检查是要检查矩阵单元N[a][b]是否为真。相关节点的邻居数度，用sum函数求得。</p>
<p>在邻接矩阵中，有一些实用的特性。</p>
<blockquote>
<p>首先，只要不允许出现自循环状态，其对角线上的值应该全为假。<br>而且，通过向现有表示法中加入双向边元素的方式来实现一个无向图，这就意味着无向图的邻接矩阵应该是一个对称矩阵。</p>
</blockquote>
<p>将邻接矩阵扩展成对边进行加权处理，也非常简单：在原来存储真值的地方直接存储对应的权值即可。</p>
<p>例如：对于边$(u,v)$来说，只需要将N[u][v]处的True替换成$\omega(u,v)$的权值即可。出于某些实践因素的考虑，通常会将一些实际不存在的边的权值设置为无穷大。（这可以确保它们不会被纳入考虑的范围，也就是说，在考虑<strong>最短路径</strong>时，我们只要根据实际存在的那些边来寻找合适路径）。</p>
<p>也可以设置为一个非法的权值，如None、-1。但许多情况下，更实用的做法是设置一个非常大的值。通常对于整型加权值来说，用<code>sys.maxint</code>即可。在对浮点型的设计中，有一个可以代表无穷大的值：inf。该值在python中没有直接可用的名称，但我们可以通过<code>float(&#39;inf&#39;)</code>表达式来获取它。</p>
<p>如下所示，演示了如何用嵌套list来实现一个加权矩阵。要注意的是，该矩阵对角线上的值依然应该全为0，因为即使在没有自循环存在的情况下，相关权值也往往会被解释称为某种距离形式，从理解上来说，任一节点到自身的距离都应该始终是0。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#对不存在的边赋予无限大权值的加权矩阵</span></div><div class="line">a, b, c, d, e, f, g, h = range(<span class="number">8</span>)</div><div class="line">inf = float(<span class="string">'inf'</span>)</div><div class="line">W = [</div><div class="line">    [<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">4</span>,inf,inf], <span class="comment">#a</span></div><div class="line">    [inf,<span class="number">0</span>,<span class="number">4</span>,inf,<span class="number">3</span>,inf,inf,inf],  <span class="comment">#b</span></div><div class="line">    [inf,inf,<span class="number">0</span>,<span class="number">8</span>,inf,inf,inf,inf], <span class="comment">#c</span></div><div class="line">    [inf,inf,inf,<span class="number">0</span>,<span class="number">7</span>,inf,inf,inf], <span class="comment">#d</span></div><div class="line">    [inf,inf,inf,inf,<span class="number">0</span>,<span class="number">5</span>,inf,inf], <span class="comment">#e</span></div><div class="line">    [inf,inf,<span class="number">2</span>,inf,inf,<span class="number">0</span>,<span class="number">2</span>,<span class="number">2</span>], <span class="comment">#f</span></div><div class="line">    [inf,inf,inf,inf,inf,<span class="number">1</span>,<span class="number">0</span>,<span class="number">6</span>], <span class="comment">#g</span></div><div class="line">    [inf,inf,inf,inf,inf,<span class="number">9</span>,<span class="number">8</span>,<span class="number">0</span>] <span class="comment">#h</span></div><div class="line">]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>W[a][b] &lt; inf <span class="comment">#Neighborhood membership</span></div><div class="line">&gt; <span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>W[c][e] &lt; inf <span class="comment"># Neighborhood membership</span></div><div class="line">&gt; <span class="keyword">False</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sum(<span class="number">1</span> <span class="keyword">for</span> w <span class="keyword">in</span> W[a] <span class="keyword">if</span> w &lt; inf) - <span class="number">1</span>  <span class="comment"># Degree</span></div><div class="line">&gt; <span class="number">5</span>    <span class="comment"># -1 是因为节点与其自身不算做边</span></div></pre></td></tr></table></figure></p>
<p>如上成员检测、查找某个特定节点的度(degree)。尽管这个表达结构在度的计算上的操作复杂度是$\theta(n)$，但它很适合于相关成员与度的查找计算操作，并且这些操作在常数时间内完成。</p>
<p><strong>小插曲</strong></p>
<blockquote>
<p>Numpy库提供大量与多维数组有关的功能。就Numpy中的数组类型而言，对于实现邻接矩阵或加权矩阵是非常不错的。<br>例如，当需要一个基于list的、面向n个结点的空加权（或邻接）矩阵时，通常这样实现：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>N= [[<span class="number">0</span>] * <span class="number">10</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</div><div class="line"><span class="comment"># 而在Numpy中，通过zeros函数实现：</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>N = np.zeros([<span class="number">10</span>,<span class="number">10</span>])</div><div class="line"><span class="comment"># 结果</span></div><div class="line">array([[ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</div><div class="line">       [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</div><div class="line">       [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</div><div class="line">       [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</div><div class="line">       [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</div><div class="line">       [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</div><div class="line">       [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</div><div class="line">       [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</div><div class="line">       [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>],</div><div class="line">       [ <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>,  <span class="number">0.</span>]])</div></pre></td></tr></table></figure></p>
<p>如果处理的是相对稀疏的图，即矩阵中只有一小部分有值，可通过更为特殊的一种稀疏矩阵的形式来节省内存开销。可以再Scipy中的scipy.sparse模块找到。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/04/26/数据需求-填充Excel-Cell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/26/数据需求-填充Excel-Cell/" itemprop="url">
                  [数据需求] 填充Excel Cell
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-26T12:11:17+08:00">
                2017-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="需求说明"><a href="#需求说明" class="headerlink" title="需求说明"></a>需求说明</h3><p>这个数据需求来自Q群水友：期望将Excel内各行的数据，在首次出现数字1之后的空单元格填充为0，单元格值为1的单元格保留不变。</p>
<p>常规的VBA可以进行处理，因为VBA已经多年不用，现在用Python来解决实现这一需求。</p>
<p>需求数据示例如下：<br><img src="http://on58f12qv.bkt.clouddn.com/%E9%9C%80%E6%B1%82%E6%A0%B7%E5%BC%8F.png" alt="需求数据样例"></p>
<p>处理转化为结果示例如下：<br><img src="http://on58f12qv.bkt.clouddn.com/%E7%BB%93%E6%9E%9C%E6%A0%B7%E5%BC%8F.png" alt="需求结果样例"></p>
<hr>
<h3 id="python实现"><a href="#Python实现" class="headerlink" title="Python实现"></a>Python实现</h3><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><p>python version：2.7.10<br>系统：windows</p>
<h4 id="第三方package"><a href="#第三方Package" class="headerlink" title="第三方Package"></a>第三方Package</h4><p>OpenPyXL<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install openpyxl</div></pre></td></tr></table></figure></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'FJ'</span></div><div class="line"><span class="string">"""</span></div><div class="line">需求: 在excel sheet页内,在每行row中,将首次出现数字1之后的空cell填充数字0</div><div class="line">python env : 2.7.10</div><div class="line">Excel version : 2016 (适用版本没有正式测试,Excel的版本应该都可以)</div><div class="line">"""</div><div class="line"></div><div class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> load_workbook</div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">operation_data</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,workbook_path,sheet_name)</span>:</span></div><div class="line">        self.workbook_path = workbook_path</div><div class="line">        self.sheet_name = sheet_name</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_workbook</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            self.workbook = load_workbook(self.workbook_path)</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">"Please check and input the correct workbook name!"</span></div><div class="line">        sheetnames = self.workbook.get_sheet_names()</div><div class="line">        <span class="keyword">if</span> sheet_name <span class="keyword">in</span> sheetnames:</div><div class="line">            self.worksheet = self.workbook.get_sheet_by_name(sheet_name)</div><div class="line">            <span class="keyword">return</span> self.workbook,self.worksheet</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">"Please check and input the correct worksheet name!"</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cell_content</span><span class="params">(self)</span>:</span></div><div class="line">        MAX_ROW = self.worksheet.max_row</div><div class="line">        MAX_COL = self.worksheet.max_column</div><div class="line">        self.cell_dict = defaultdict(list)</div><div class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">1</span>,MAX_ROW+<span class="number">1</span>):</div><div class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> range(<span class="number">1</span>,MAX_COL+<span class="number">1</span>):</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    value = self.worksheet.cell(row=row, column=col).value</div><div class="line">                    self.cell_dict[row].append(value)</div><div class="line">                <span class="keyword">except</span> Exception,e:</div><div class="line">                    <span class="keyword">print</span> e</div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">        <span class="keyword">return</span> self.cell_dict</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update_cell_content</span><span class="params">(self)</span>:</span></div><div class="line">        n,m = len(self.cell_dict),len(self.cell_dict[<span class="number">1</span>])</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,n+<span class="number">1</span>):</div><div class="line">            <span class="keyword">if</span> <span class="number">1</span> <span class="keyword">in</span> self.cell_dict[i]:</div><div class="line">                j = self.cell_dict[i].index(<span class="number">1</span>)</div><div class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> range(j,m):</div><div class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> self.cell_dict[i][k]:</div><div class="line">                        self.cell_dict[i][k] = <span class="number">0</span></div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        <span class="keyword">continue</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">        <span class="keyword">return</span> self.cell_dict</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_excel</span><span class="params">(self,workbook_name)</span>:</span></div><div class="line">        n,m = len(self.cell_dict),len(self.cell_dict[<span class="number">1</span>])</div><div class="line">        worksheet = self.workbook.create_sheet(<span class="string">'Sheet2'</span>,<span class="number">0</span>)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,n+<span class="number">1</span>):</div><div class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,m+<span class="number">1</span>):</div><div class="line">                worksheet.cell(row=i,column=j,value=self.cell_dict[i][j<span class="number">-1</span>])</div><div class="line">        self.workbook.save(workbook_name)</div><div class="line">        <span class="keyword">print</span> <span class="string">"The data transform has been done successfully!"</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></div><div class="line">        workbook,worksheet = self.get_workbook()</div><div class="line">        cell_dict = self.get_cell_content()</div><div class="line">        cell_dict = self.update_cell_content()</div><div class="line">        self.write_excel(<span class="string">u"测试结果1.xlsx"</span>)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    workbook_path,sheet_name = <span class="string">u'./测试.xlsx'</span>,<span class="string">'Sheet1'</span></div><div class="line">    excel_obj = operation_data(workbook_path,sheet_name)</div><div class="line">    excel_obj.main()</div><div class="line"></div><div class="line"><span class="comment"># ------------------------------------------</span></div><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'FJ'</span></div><div class="line"><span class="string">"""</span></div><div class="line">需求: 在excel sheet页内,在每行row中,将首次出现数字1之后的空cell填充数字0</div><div class="line">python env : 2.7.10</div><div class="line">Excel version : 2016 (适用版本没有正式测试,Excel的版本应该都可以)</div><div class="line">"""</div><div class="line"></div><div class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> load_workbook</div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_workbook</span><span class="params">(workbook_path,sheet_name)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        workbook = load_workbook(workbook_path)</div><div class="line">    <span class="keyword">except</span> Exception,e:</div><div class="line">        <span class="keyword">print</span> <span class="string">"Please check and input the correct workbook name!"</span></div><div class="line">    sheetnames = workbook.get_sheet_names()</div><div class="line">    <span class="keyword">if</span> sheet_name <span class="keyword">in</span> sheetnames:</div><div class="line">        worksheet = workbook.get_sheet_by_name(sheet_name)</div><div class="line">        <span class="keyword">return</span> workbook,worksheet</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"Please check and input the correct worksheet name!"</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cell_content</span><span class="params">(worksheet)</span>:</span></div><div class="line">    MAX_ROW = worksheet.max_row</div><div class="line">    MAX_COL = worksheet.max_column</div><div class="line">    result = defaultdict(list)</div><div class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">1</span>,MAX_ROW+<span class="number">1</span>):</div><div class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> range(<span class="number">1</span>,MAX_COL+<span class="number">1</span>):</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                value = worksheet.cell(row=row, column=col).value</div><div class="line">                result[row].append(value)</div><div class="line">            <span class="keyword">except</span> Exception,e:</div><div class="line">                <span class="keyword">print</span> e</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">    <span class="keyword">return</span> result</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_cell_content</span><span class="params">(cell_dict)</span>:</span></div><div class="line">    n,m = len(cell_dict),len(cell_dict[<span class="number">1</span>])</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,n+<span class="number">1</span>):</div><div class="line">        <span class="keyword">if</span> <span class="number">1</span> <span class="keyword">in</span> cell_dict[i]:</div><div class="line">            j = cell_dict[i].index(<span class="number">1</span>)</div><div class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(j,m):</div><div class="line">                <span class="keyword">if</span> <span class="keyword">not</span> cell_dict[i][k]:</div><div class="line">                    cell_dict[i][k] = <span class="number">0</span></div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">    <span class="keyword">return</span> cell_dict</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_excel</span><span class="params">(cell_dict,workbook,workbook_name)</span>:</span></div><div class="line">    n,m = len(cell_dict),len(cell_dict[<span class="number">1</span>])</div><div class="line">    worksheet = workbook.create_sheet(<span class="string">'Sheet2'</span>,<span class="number">0</span>)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,n+<span class="number">1</span>):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,m+<span class="number">1</span>):</div><div class="line">            worksheet.cell(row=i,column=j,value=cell_dict[i][j<span class="number">-1</span>])</div><div class="line">    workbook.save(workbook_name)</div><div class="line">    <span class="keyword">print</span> <span class="string">"The data transform has been done successfully!"</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(workbook_path,sheet_name)</span>:</span></div><div class="line">    workbook,worksheet = get_workbook(workbook_path,sheet_name)</div><div class="line">    cell_dict = get_cell_content(worksheet)</div><div class="line">    cell_dict = update_cell_content(cell_dict)</div><div class="line">    write_excel(cell_dict,workbook,<span class="string">u"测试结果.xlsx"</span>)</div><div class="line">    <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    workbook_path,sheet_name = <span class="string">u'./测试.xlsx'</span>,<span class="string">'Sheet1'</span></div><div class="line">    main(workbook_path,sheet_name)</div></pre></td></tr></table></figure>
<hr>
<h3 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h3><p><a href="https://openpyxl.readthedocs.io/en/default/index.html" target="_blank" rel="external">OpenPyXL</a>  :  <a href="https://openpyxl.readthedocs.io/en/default/index.html" target="_blank" rel="external">https://openpyxl.readthedocs.io/en/default/index.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/04/24/《Python算法教程》读书笔记-（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/24/《Python算法教程》读书笔记-（二）/" itemprop="url">
                  《Python算法教程》读书笔记 - （二）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-24T09:11:27+08:00">
                2017-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>《Python Algorithms》主体内容是“数学技术”、“算法设计原则”和“经典算法”。</p>
<p>首先聚焦于两个话题：<strong>渐进记忆法(asymptotic notation)</strong>，关注运行时间的本质。另外就是<strong>树(tree)</strong>和<strong>图(graph)</strong>数据结构的Python实现方法。</p>
<p>算法，指包含能够解决某个特定问题的有限步骤集的执行过程。</p>
<hr>
<h3 id="渐进记忆法"><a href="#渐进记忆法" class="headerlink" title="渐进记忆法"></a>渐进记忆法</h3><p>在常数单位上的差距（通常取决于一些特定的事物，如编程语言的性能、硬件速度等），以及其在问题规模扩大时运行时间的增长幅度，才是研究算法分析时所要关心的中点。</p>
<p><strong>小插曲：</strong></p>
<blockquote>
<p>Python中的list不是传统意义上的列表，这即使append操作比insert操作高效的原因所在。<br>传统列表也叫做链表(linked list)，由一系列节点来实现，其每个结点(尾节点除外)中都持有一个指向下一节点的引用。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,value,next=None)</span>:</span></div><div class="line">		self.value = value</div><div class="line">		self.next = next</div><div class="line"><span class="comment"># 将所有节点构造成一个列表</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>L = Node(<span class="string">"a"</span>,Node(<span class="string">"b"</span>,Node(<span class="string">"c"</span>,Node(<span class="string">"d"</span>))))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>L.next.next.value</div><div class="line"><span class="string">'c'</span></div></pre></td></tr></table></figure></p>
<p>这是一个单向列表。双向列表的各节点中还需要持有一个指向前一节点的引用。<br>但Python中的list与此有些不同。Python的list不是由若干个独立的节点相互引用而成，而是一整块单一连续的内存区块，通常称为数组(array)。<br>尽管两者在遍历时的效率相差无几，但若按既定索引值对某元素进行直接访问的话，显然使用数组会更有效率！因为在数组中，可以直接计算出目标元素在内存中的位置，并能对其进行直接访问。而对于链表而言，必须从头开始遍历整个链表。</p>
<p>但具体到insert操作上，情况又会有所不同。对于链表而言，只要知道要在哪里执行insert操作，其操作成本非常低的。无论该列表中有多少元素，其操作时间大致上是相同的。而数组就不一样了，它每次执行insert操作都需要移动插入点右边所有元素，甚至在必要时，可能还需要将这些列表元素整体搬到一个更大的数组中去。<br>正因如此，append操作通常采用一种被称为<strong>动态数组或向量</strong>的特定解决方案，其主要想法是将内存分配的大一些，并且等到其溢出时，在线性时间内再次重新分配内存。<br>尽管两者情况都会迫使我们去搬动大量的元素，但主要的不用点在于，对append操作发生这样的可能性要小的多，如果能确保每次所搬入的数组都打过原数组一定的比例(20%甚至100%)，那么该操作的平均成本通常是常数的。</p>
</blockquote>
<hr>
<h4 id="时间复杂度定义"><a href="#时间复杂度定义" class="headerlink" title="时间复杂度定义"></a>时间复杂度定义</h4><p>通常，所获得的运行时间往往取决于某个特定基本操作被执的次数。</p>
<p>渐进记忆法记号分别是$O（大O）$、$Ω$、$\theta$。$O$记法所代表的其实是所谓的渐进上界，而$Ω$记法所代表的则是渐进下界，$\theta$正好是前两种记法的交集。</p>
<p>对于Python中的list而言，append n个数字所需要的运行时间约为$O(n)$，而在首端insert相同数量的数字需要的时间约为$O(n^2)$。</p>
<hr>
<h4 id="时间复杂度示例"><a href="#时间复杂度示例" class="headerlink" title="时间复杂度示例"></a>时间复杂度示例</h4><p>渐进记号最大限度的简化了数学问题，可以忽略乘法或加法中的那些常数，以及函数中其他<em>所有影响较小的部分</em>，从而让事情得到很大程度的简化。<br>下表给出一些时间复杂度对应的示例，并按照复杂度来排序，即每一行都要比它的前一行复杂。<br>$\theta(1)$         常数级            哈希表的查询与修改<br>$\theta(lg n)$         对数级        二分搜索<br>$\theta(n)$        线性级        列表的遍历<br>$\theta(n lg n)$        线性对数级            任意值序列的最优化排序<br>$\theta(n^2)$         平方级            n个对象相互比对<br>$\theta(n^3)$        立方级            Floyed-Warshall算法<br>$\theta(n^k)$        多项式级        基于n的k层嵌套循环<br>$\theta(k^n)$      指数级<br>$\theta(n{!})$      阶乘级</p>
<p>注：有的时间复杂度不理解，后续逐步深入学习</p>
<hr>
<h4 id="时间复杂度练习"><a href="#时间复杂度练习" class="headerlink" title="时间复杂度练习"></a>时间复杂度练习</h4><p>首先要考虑的是程序在时间复杂度与问题规模之间的关系。</p>
<p>例一：假设对大小为n的list，调用一次append的复杂度为$\theta(1)$，而调用一次insert(0,x)的复杂度则为$\theta(n)$。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nums.append(<span class="number">1</span>)</div><div class="line">nums.insert(<span class="number">0</span>,<span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<p>第一行时间复杂度为常数时间，当执行到第二行时，list的大小已经变成n+1，即现在的时间复杂度应该为$\theta(n+1)$，它与$\theta(n)$是等价的。总的运行时间就是这两种复杂度之和：$\theta(1) + \theta(n) = \theta(n)$。</p>
<p>例二：简单循环遍历n个元素序列。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">s = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> x <span class="keyword">in</span> seq:		<span class="comment"># seqp = range(n)</span></div><div class="line">	s += x</div></pre></td></tr></table></figure></p>
<p>对seq中的n个元素都执行了常数时间操作，其运行时间应该是线性的，即$\theta(n)$，而初始化操作被站主导地位的循环操作忽略掉了。同样逻辑也使用与内嵌式循环代码中，例如列表解析式和生成器表达式。</p>
<p>例三：涉及嵌套循环时，单独每一层循环都是线性的，但层与层之间是依赖的关系，因此时间复杂度是线性的乘方的。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">s = o </div><div class="line"><span class="keyword">for</span> x <span class="keyword">in</span> seq:</div><div class="line">	<span class="keyword">for</span> y <span class="keyword">in</span> seq:</div><div class="line">		s += x * y</div></pre></td></tr></table></figure></p>
<p>其实，基本的规则是：代码块的时间复杂度由其先后执行的语句累加而成；而嵌套循环的时间复杂度则在此基础上成本的增长。理由很简单：由于外层循环每执行一次，内循环都要完整执行一遍。此时，其时间复杂度相当于“线性级乘线性级”，即平方级，$\theta(n * n) = \theta(n^2)$。这种规则可以用于指代更多层嵌套，只需随之增加其乘方数值即可($\theta(n^k)$)！</p>
<p>例四：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">s = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> x <span class="keyword">in</span> seq:</div><div class="line">	<span class="keyword">for</span> y <span class="keyword">in</span> seq:</div><div class="line">		s += x * y</div><div class="line">	<span class="keyword">for</span> z <span class="keyword">in</span> seq:</div><div class="line">		<span class="keyword">for</span> w <span class="keyword">in</span> seq:</div><div class="line">			s += x -w</div></pre></td></tr></table></figure></p>
<p>z循环是线性，且其中嵌套一个线性循环，此时时间复杂度是平方级$\theta(n^2)$；y循环时间复杂度是线性$\theta(n)$的。x循环的时间复杂度是$\theta(n(n^2 + n)) = \theta(n^3 + n^2) = \theta(n^3)$，即立方级。z循环在时间复杂度中占主导贡献。</p>
<p>例五：算出序列中各元素之间的乘积之和，要求是避免对象自身相乘或者同一乘积被累加两次的情况。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">s = <span class="number">0</span></div><div class="line">n = len(seq)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n<span class="number">-1</span>):</div><div class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>,n):</div><div class="line">		s += seq[i] * seq[j]</div><div class="line"><span class="comment">## 结果  seq = [1,2,3,4,5]</span></div><div class="line"><span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">1</span> <span class="number">3</span></div><div class="line"><span class="number">1</span> <span class="number">4</span></div><div class="line"><span class="number">1</span> <span class="number">5</span></div><div class="line"><span class="number">2</span> <span class="number">3</span></div><div class="line"><span class="number">2</span> <span class="number">4</span></div><div class="line"><span class="number">2</span> <span class="number">5</span></div><div class="line"><span class="number">3</span> <span class="number">4</span></div><div class="line"><span class="number">3</span> <span class="number">5</span></div><div class="line"><span class="number">4</span> <span class="number">5</span></div></pre></td></tr></table></figure></p>
<p>时间复杂度是多少呢？</p>
<hr>
<h4 id="三种重要情况"><a href="#三种重要情况" class="headerlink" title="三种重要情况"></a>三种重要情况</h4><p>实际情况中，比如构建一个排序算法的话，我们可能这样的代码逻辑：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort_w_check</span><span class="params">(seq)</span>:</span></div><div class="line">	n = len(seq)</div><div class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(n<span class="number">-1</span>):</div><div class="line">		<span class="keyword">if</span> seq[i] &gt; seq[i+<span class="number">1</span>]</div><div class="line">			<span class="keyword">break</span></div><div class="line">	<span class="keyword">else</span>:</div><div class="line">		<span class="keyword">return</span> ...</div><div class="line"><span class="comment"># 在进行实际排序之前先做一个检查，如果目标序列已经排序，函数就直接返回。</span></div></pre></td></tr></table></figure></p>
<p>此种情况下，无论排序算法的效率多低，只要输入是已排序的序列，其时间复杂度始终是线性级的。而在一般情况下是没有排序算法能达到线性级运行时间的。此时所谓的“最好的情况”实际是一个异常情况。我们不能依据这个来预测可靠的时间复杂度。因此引出有关时间复杂度的三种重要情况：</p>
<ol>
<li><strong>最好的情况：</strong>算法在理想输入时的时间复杂度，此例中是线性级。</li>
<li><strong>最坏的情况：</strong>通常最有用的情况，希望对算法效率做出某些保证，此时最坏情况下的时间复杂度即是给出的最佳保证。</li>
<li><strong>平均情况：</strong>最复杂的情况，简而言之就是它是对于按照一定的概率分布的随机输入的期望运行时间。一般会回避这种情况。</li>
</ol>
<p>估计时间复杂度的基本原则：通常以最坏的情况下的时间复杂度为准，即直接选择上界或下界(用$O$或$Ω$)来描述问题。</p>
<hr>
<h4 id="算法工程与算法评估"><a href="#算法工程与算法评估" class="headerlink" title="算法工程与算法评估"></a>算法工程与算法评估</h4><p>算法工程(algorithm engineering)，即如何有效实现相关算法。</p>
<ol>
<li><strong>提示一：只要有可能，就不必去担心</strong>  对时间复杂度的担心可能很重要，但只要有可能就不必去担心。不妨试试先简单实现程序，然后再看看它是否足够好！如果感觉无从下手时，推荐蛮力算法。</li>
<li><strong>提示二：请用timeit模块来进行计算</strong>  timeit模块本身就是为执行相对可靠的计时操作而设计的！<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> timeit</div><div class="line"><span class="keyword">print</span> timeit.timeit(<span class="string">"l = range(1000)"</span>)</div><div class="line"><span class="comment">## 结果</span></div><div class="line"><span class="number">0.0169961213126</span></div><div class="line"><span class="number">6.22491721517</span></div><div class="line"></div><div class="line"><span class="comment"># 对封装的函数进行计时</span></div><div class="line">$ python -m timeit <span class="string">"import mymodule as m"</span> <span class="string">"m.myfunction()"</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>后续详细的学习下<code>timeit</code>模块。</p>
<ol>
<li><p><strong>提示3：请使用profiler找出瓶颈</strong>  确定自己的代码中需要优化的是哪一部分！使用<code>cProfiler</code>模块(trace模块)！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> cProfiler</div><div class="line"><span class="comment"># 自定义的主函数main(),结果打印出各函数的计时结果</span></div><div class="line">cProfiler.run(<span class="string">'main()'</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><strong>绘制出结果</strong>  可视化往往是最好的工具。常见的是放映问题规模与运行时间关系的图表，或展示的相关运行时间的详细分布情况的图表。推荐<code>matplotlib</code>。<br>后续详细的学习下<code>matplotlib</code>模块。</p>
</li>
<li><strong>根据计时对比结果做出判断时要小心</strong>  </li>
</ol>
<p>我们进行时间复杂度分析的目的也主要是为了实现算法，以及在实际问题中运行算法时，能够对该算法的行为做出某些描述。</p>
<p>下一篇博客详细学习树和图数据结构！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://fujiador.github.io/2017/04/20/smtplib-Python-操作SMTP服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fujia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fujia's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/20/smtplib-Python-操作SMTP服务/" itemprop="url">
                  smtplib  Python 操作SMTP服务
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-20T23:45:45+08:00">
                2017-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>smtplib</code>模块定义了一个SMTP客户端会话对象，通过使用SMTP或ESMTP监听守护程序向互联网计算机发送邮件。</p>
<p>在日常工作中用到最多的核心class是<code>SMTP</code>。所以，今天的主题就是搞定<code>SMTP</code>。</p>
<h3 id="class-smtplibsmtp"><a href="#class-smtplib-SMTP" class="headerlink" title="class smtplib.SMTP"></a><code>class smtplib.SMTP</code></h3><p>SMTP实例将SMTP连接行为进行封装，支持完整的SMPT和ESMTP协议相关的操作方法，可选的参数<code>([host[, port[, local_hostname[, timeout]]]])</code>。官方文档也已经提示，平常的使用需求，一般只需要掌握初始化、connect、sendmail()和quit()方法即可。</p>
<p>简单的说明下<code>class smtplib.SMTP_SSL</code>类，其行为与<code>SMTP</code>实例行为完全相同，主要用在从连接开始就需要SSL的情况。接下来重点学习<code>SMTP</code>类及其方法。</p>
<hr>
<h3 id="smtp-方法"><a href="#SMTP-方法" class="headerlink" title="SMTP 方法"></a>SMTP 方法</h3><p><code>SMTP</code>类主要管理对SMTP或ESMTP服务器进行连接的方法。<code>SMTP</code>实例主要拥有以下方法：</p>
<ol>
<li><code>__init__(self,host=&#39;&#39;,port=0,local_hostname=None,timeout=&lt;object object&gt;)</code>：利用所给参数初始化一个新SMTP实例。</li>
<li><code>close(self)</code>：关闭与SMTP服务器的连接。</li>
<li><code>connect(self,host=&#39;localhost&#39;,port=0)</code>：连接到给定端口的主机上。如果主机名以冒号加数字结尾，且没有指定端口。会自动将冒号后的端口与主机名分离使用。</li>
<li><code>data(self,msg)</code>：将消息数据发送到服务器。</li>
<li><code>docmd(self,cmd,args=&#39;&#39;)</code>：发送命令并返回其响应代码值。在我的任务中没有用到。</li>
<li><code>getreply(self)</code>：从服务器获取答复，返回服务器响应代码。</li>
<li><code>login(self,user,password)</code>：登录需要身份验证的SMTP服务器，参数user即要认证的用户名，password是所需的验证密码。</li>
<li><code>mail(self,sender,option=[])</code>：开始邮件xfer会话。</li>
<li><code>quit(self)</code>：终止SMTP会话。</li>
<li><code>sendmail(self,from_addr,to_adder,msg,mail_options=[],rcpt_options=[])</code>：此命令执行整个邮件事务。from_addr即发送此邮件的地址；to_addr即收件人的地址列表；msg即要发送的消息。常见的一个异常是，收件人邮箱地址异常无法正常发送邮件，此方法会返回一个类似<code>{&quot;theuser@mail.com&quot;:(550,&quot;User unknown&quot;)}</code>字典。如有所有收件人地址都正常，返回一个孔字典。</li>
</ol>
<hr>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>核心的方法包括：connect、login、sendmail、close等。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! -*- coding:utf-8 -*-</span></div><div class="line">__author__ = <span class="string">'MaFuJia'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> smtplib</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">SendMail_Enterprise</span><span class="params">(AUTH_USER, AUTH_PASSWORD, from_addr, to_addrs, msg)</span>:</span></div><div class="line">    <span class="string">"""Send the email to email_addresses used by Tencent Enterprise Email Server</span></div><div class="line">    argments as following:</div><div class="line">        AUTH_USER : 登录SMTP服务器认证用户名</div><div class="line">        AUTH_PASSWORD : 认证用户的邮箱密码</div><div class="line">        from_addr : 发件人邮箱地址,要求发件人与认证用户一致</div><div class="line">        to_addr : 收件人列表</div><div class="line">    """</div><div class="line">    SMTP_HOST = <span class="string">'smtp.exmail.qq.com'</span></div><div class="line">    POSTFIX = <span class="string">'gmail.com'</span></div><div class="line">    mail_Server = smtplib.SMTP()</div><div class="line">    mail_Server.connect(SMTP_HOST)</div><div class="line">    mail_Server.login(AUTH_USER + <span class="string">'@'</span> + POSTFIX, AUTH_PASSWORD)</div><div class="line">    mail_Server.sendmail(from_addr, to_addrs, msg)</div><div class="line">    mail_Server.close()</div><div class="line">    <span class="keyword">return</span> <span class="string">u"Sending Emails Operation has been successful completed!"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_Enterprise</span><span class="params">()</span>:</span></div><div class="line">    AUTH_USER = <span class="string">'user_name'</span></div><div class="line">    AUTH_PASSWORD = <span class="string">'password'</span></div><div class="line">    from_addr = <span class="string">'user_name@gmail.com'</span></div><div class="line">    to_addrs = [<span class="string">'user_name@gmail.com'</span>,<span class="string">'4006688**@qq.com'</span>]</div><div class="line">    msg = <span class="string">'hello world!'</span></div><div class="line"></div><div class="line">    SendMail_Enterprise(AUTH_USER, AUTH_PASSWORD, from_addr, to_addrs, msg)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">SendMail_Personal</span><span class="params">(AUTH_USER, AUTH_PASSWORD, from_addr, to_addrs, msg)</span>:</span></div><div class="line">    <span class="string">"""Send the email to email_addresses used by Tencent Personal Email Server</span></div><div class="line">    argments as following:</div><div class="line">        AUTH_USER : 登录SMTP服务器认证用户名</div><div class="line">        AUTH_PASSWORD : 认证用户的邮箱对应的授权码</div><div class="line">        from_addr : 发件人邮箱地址,要求发件人与认证用户一致</div><div class="line">        to_addr : 收件人列表</div><div class="line">    """</div><div class="line">    SMTP_HOST = <span class="string">'smtp.qq.com'</span></div><div class="line">    SMTP_PORT = <span class="number">25</span></div><div class="line">    POSTFIX = <span class="string">'qq.com'</span></div><div class="line">    mail_Server = smtplib.SMTP()</div><div class="line">    mail_Server.connect(SMTP_HOST, SMTP_PORT)</div><div class="line">    mail_Server.ehlo()</div><div class="line">    mail_Server.set_debuglevel(<span class="number">0</span>)</div><div class="line">    mail_Server.starttls()</div><div class="line">    mail_Server.ehlo()</div><div class="line">    mail_Server.login(AUTH_USER + <span class="string">'@'</span> + POSTFIX, AUTH_PASSWORD)</div><div class="line">    mail_Server.sendmail(from_addr, to_addrs, msg)</div><div class="line">    mail_Server.close()</div><div class="line">    <span class="keyword">return</span> <span class="string">u"Sending Emails Operation has been successful completed!"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_Personal</span><span class="params">()</span>:</span></div><div class="line">    AUTH_USER = <span class="string">'406526***'</span></div><div class="line">    AUTH_PASSWORD = <span class="string">'*n*h*x*d*c*x*i*g'</span>    <span class="comment"># QQ邮箱16位授权码</span></div><div class="line">    from_addr = <span class="string">'406526***@qq.com'</span></div><div class="line">    to_addrs = [<span class="string">'user_name@gmail.com'</span>,<span class="string">'406526***@qq.com'</span>]</div><div class="line">    msg = <span class="string">'hello world!'</span></div><div class="line"></div><div class="line">    SendMail_Personal(AUTH_USER, AUTH_PASSWORD, from_addr, to_addrs, msg)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main_Enterprise()</div><div class="line">    main_Personal()</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://docs.python.org/2/library/smtplib.html" target="_blank" rel="external">https://docs.python.org/2/library/smtplib.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Fujia" />
          <p class="site-author-name" itemprop="name">Fujia</p>
           
              <p class="site-description motion-element" itemprop="description">好记性不如烂笔头,更何况记性还不好</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fujia</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



  



  




	





  





  





  






  





  

  

  

  

</body>
</html>
